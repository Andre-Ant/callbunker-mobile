<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CallBunker Mobile</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8f9fa;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .header {
            background: white;
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        .header h1 {
            color: #1c1c1e;
            font-size: 20px;
            font-weight: 600;
        }
        
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #007aff;
        }
        
        .stat-label {
            font-size: 12px;
            color: #8e8e93;
            margin-top: 4px;
        }
        
        .actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }
        
        .action-btn {
            background: white;
            border: none;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        
        .action-btn:active {
            transform: scale(0.95);
        }
        
        .action-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }
        
        .action-title {
            font-size: 14px;
            font-weight: 600;
            color: #1c1c1e;
        }
        
        .action-subtitle {
            font-size: 12px;
            color: #8e8e93;
            margin-top: 4px;
        }
        
        /* Messages Screen */
        .messages-center {
            text-align: center;
            padding: 60px 20px;
        }
        
        .message-icon {
            font-size: 64px;
            margin-bottom: 16px;
            color: #c7c7cc;
        }
        
        .message-title {
            font-size: 24px;
            font-weight: 600;
            color: #1c1c1e;
            margin-bottom: 12px;
        }
        
        .message-subtitle {
            font-size: 16px;
            color: #8e8e93;
            line-height: 1.4;
        }
        
        /* Dialer */
        .dialer-container {
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 16px;
        }
        
        .dialer-display {
            text-align: center;
            padding: 16px;
            background: white;
            border-radius: 12px;
            margin-bottom: 16px;
        }
        
        .phone-number {
            font-size: 28px;
            color: #1c1c1e;
            margin-bottom: 8px;
            min-height: 35px;
        }
        
        .privacy-badge {
            background: #e8f5e8;
            color: #4caf50;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            display: inline-block;
        }
        
        .dialpad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
            flex: 1;
            align-content: center;
        }
        
        .dial-btn {
            height: 60px;
            width: 60px;
            justify-self: center;
            background: white;
            border: none;
            border-radius: 50%;
            font-size: 20px;
            font-weight: 300;
            color: #1c1c1e;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .dial-btn:active {
            transform: scale(0.95);
        }
        
        .dial-letters {
            font-size: 8px;
            color: #8e8e93;
            margin-top: -2px;
        }
        
        .call-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            align-items: center;
            padding-bottom: 10px;
        }
        
        .call-btn {
            width: 55px;
            height: 55px;
            border-radius: 28px;
            border: none;
            background: #4caf50;
            color: white;
            font-size: 22px;
            cursor: pointer;
        }
        
        .call-btn:active {
            transform: scale(0.95);
        }
        
        .back-btn {
            width: 45px;
            height: 45px;
            border-radius: 23px;
            border: none;
            background: #f2f2f7;
            color: #ff3b30;
            font-size: 18px;
            cursor: pointer;
        }
        
        .back-btn:active {
            transform: scale(0.95);
        }
        
        /* List Items */
        .list-item {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .list-item:active {
            transform: scale(0.98);
        }
        
        .list-avatar {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            background: #f2f2f7;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 18px;
        }
        
        .list-content {
            flex: 1;
        }
        
        .list-title {
            font-size: 16px;
            font-weight: 500;
            color: #1c1c1e;
        }
        
        .list-subtitle {
            font-size: 14px;
            color: #8e8e93;
            margin-top: 2px;
        }
        
        .list-meta {
            font-size: 14px;
            color: #4caf50;
            font-weight: 500;
        }
        
        .list-arrow {
            color: #c7c7cc;
            font-size: 16px;
        }
        
        /* Detail Views */
        .detail-screen {
            display: none;
            padding: 16px;
        }
        
        .detail-screen.active {
            display: block;
        }
        
        .detail-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .back-arrow {
            background: none;
            border: none;
            font-size: 20px;
            color: #007aff;
            cursor: pointer;
            margin-right: 12px;
        }
        
        .detail-title {
            font-size: 18px;
            font-weight: 600;
            color: #1c1c1e;
        }
        
        .detail-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }
        
        .detail-label {
            font-size: 12px;
            color: #8e8e93;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        
        .detail-value {
            font-size: 16px;
            color: #1c1c1e;
            font-weight: 500;
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .feature-item {
            padding: 8px 0;
            border-bottom: 1px solid #f2f2f7;
            display: flex;
            align-items: center;
        }
        
        .feature-item:last-child {
            border-bottom: none;
        }
        
        .feature-icon {
            margin-right: 8px;
            color: #4caf50;
        }
        
        .feature-text {
            color: #1c1c1e;
            font-size: 14px;
        }
        
        /* Tab Bar */
        .tab-bar {
            background: white;
            border-top: 1px solid #eee;
            padding: 10px 0;
            display: grid;
            grid-template-columns: repeat(6, 1fr);
        }
        
        .tab {
            text-align: center;
            cursor: pointer;
            padding: 8px 4px;
        }
        
        .tab.active {
            color: #007aff;
        }
        
        .tab:not(.active) {
            color: #8e8e93;
        }
        
        .tab-icon {
            font-size: 20px;
            margin-bottom: 2px;
        }
        
        .tab-label {
            font-size: 10px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 id="screen-title">CallBunker</h1>
    </div>
    
    <div class="content">
        <!-- Home Screen -->
        <div class="screen active" id="home">
            <div class="card" onclick="showAnalytics()" style="cursor: pointer;">
                <div style="display: flex; align-items: center; margin-bottom: 16px;">
                    <div style="font-size: 32px; color: #4caf50; margin-right: 12px;">🛡️</div>
                    <div>
                        <div style="font-size: 18px; font-weight: 600; color: #1c1c1e;">Privacy Protected</div>
                        <div style="font-size: 14px; color: #8e8e93;">Your real number is hidden • Tap for details</div>
                    </div>
                </div>
                <div class="stats">
                    <div>
                        <div class="stat-number" id="blocked-calls-stat" style="color: #ff3b30;">6</div>
                        <div class="stat-label">Blocked Calls</div>
                    </div>
                    <div>
                        <div class="stat-number" id="trusted-contacts-stat" style="color: #4caf50;">2</div>
                        <div class="stat-label">Trusted Contacts</div>
                    </div>
                </div>
            </div>
            
            <div class="actions">
                <button class="action-btn" onclick="switchTab('dialer')">
                    <div class="action-icon" style="color: #007aff;">📞</div>
                    <div class="action-title">Protected Call</div>
                    <div class="action-subtitle">Hide your number</div>
                </button>
                <button class="action-btn" onclick="switchTab('contacts')">
                    <div class="action-icon" style="color: #ff9500;">👥</div>
                    <div class="action-title">Trusted Contacts</div>
                    <div class="action-subtitle">Manage whitelist</div>
                </button>
            </div>
        </div>
        
        <!-- Dialer Screen -->
        <div class="screen" id="dialer">
            <div class="dialer-container">
                <div class="dialer-display">
                    <div class="phone-number" id="phone-display">Enter number</div>
                    <div class="privacy-badge">🛡️ Privacy Protected</div>
                </div>
                
                <div class="dialpad">
                    <button class="dial-btn" onclick="addDigit('1')">1</button>
                    <button class="dial-btn" onclick="addDigit('2')">2<br><span class="dial-letters">ABC</span></button>
                    <button class="dial-btn" onclick="addDigit('3')">3<br><span class="dial-letters">DEF</span></button>
                    <button class="dial-btn" onclick="addDigit('4')">4<br><span class="dial-letters">GHI</span></button>
                    <button class="dial-btn" onclick="addDigit('5')">5<br><span class="dial-letters">JKL</span></button>
                    <button class="dial-btn" onclick="addDigit('6')">6<br><span class="dial-letters">MNO</span></button>
                    <button class="dial-btn" onclick="addDigit('7')">7<br><span class="dial-letters">PQRS</span></button>
                    <button class="dial-btn" onclick="addDigit('8')">8<br><span class="dial-letters">TUV</span></button>
                    <button class="dial-btn" onclick="addDigit('9')">9<br><span class="dial-letters">WXYZ</span></button>
                    <button class="dial-btn" onclick="addDigit('*')">*</button>
                    <button class="dial-btn" onclick="addDigit('0')">0<br><span class="dial-letters">+</span></button>
                    <button class="dial-btn" onclick="addDigit('#')">#</button>
                </div>
                
                <div class="call-actions">
                    <button class="back-btn" onclick="backspace()">⌫</button>
                    <button class="call-btn" onclick="makeCall()">📞</button>
                </div>
            </div>
        </div>
        
        <!-- Messages Screen -->
        <div class="screen" id="messages">
            <div class="messages-center">
                <div class="message-icon">💬</div>
                <div class="message-title">SMS Coming Soon</div>
                <div class="message-subtitle">Secure messaging with privacy protection will be available shortly.</div>
            </div>
        </div>
        
        <!-- History Screen -->
        <div class="screen" id="history">
            <div class="list-item">
                <div class="list-avatar">📞</div>
                <div class="list-content">
                    <div class="list-title">(555) 123-4567</div>
                    <div class="list-subtitle">2m ago</div>
                </div>
                <div class="list-meta">2:34</div>
            </div>
            <div class="list-item">
                <div class="list-avatar">📞</div>
                <div class="list-content">
                    <div class="list-title">(555) 987-6543</div>
                    <div class="list-subtitle">1h ago</div>
                </div>
                <div class="list-meta">1:45</div>
            </div>
        </div>
        
        <!-- Contacts Screen -->
        <div class="screen" id="contacts">
            <div style="background: #e8f5e8; padding: 16px; border-radius: 12px; margin-bottom: 16px; display: flex; align-items: center;">
                <span style="color: #4caf50; font-size: 20px; margin-right: 8px;">🛡️</span>
                <span style="color: #4caf50; font-size: 14px;">Trusted contacts bypass screening</span>
            </div>
            
            <div style="margin-bottom: 12px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <div style="font-size: 16px; font-weight: 600; color: #1c1c1e;">Trusted Contacts (2)</div>
                    <div id="contacts-actions" style="display: flex; gap: 8px; align-items: center;">
                        <button onclick="selectAllContacts()" style="background: #007aff; color: white; border: none; border-radius: 6px; padding: 6px 12px; font-size: 12px;">Select All</button>
                    </div>
                    <div id="contacts-selection-actions" style="display: none;">
                        <span id="contacts-selection-count" style="font-size: 12px; color: #8e8e93; margin-right: 8px;">0 selected</span>
                        <button onclick="cancelContactsSelection()" style="background: #8e8e93; color: white; border: none; border-radius: 6px; padding: 6px 12px; font-size: 12px; margin-right: 4px;">Cancel</button>
                        <button onclick="removeSelectedContacts()" style="background: #ff3b30; color: white; border: none; border-radius: 6px; padding: 6px 12px; font-size: 12px;">Remove Selected</button>
                    </div>
                </div>
                <div id="contacts-multi-select-container" style="text-align: center; padding: 8px 0; border-top: 1px solid #e5e5ea;">
                    <!-- Multi-select button will be added here dynamically -->
                </div>
            </div>
            
            <div id="contacts-list">
                <div class="list-item contact-item" onclick="showContactDetail('john')" data-contact="john" data-phone="(555) 123-4567">
                    <div class="contacts-selection-checkbox" style="display: none; margin-right: 12px; width: 20px; height: 20px; border: 2px solid #007aff; border-radius: 4px; position: relative;">
                        <div class="checkmark" style="display: none; position: absolute; top: 2px; left: 6px; width: 6px; height: 10px; border: solid white; border-width: 0 2px 2px 0; transform: rotate(45deg);"></div>
                    </div>
                    <div class="list-avatar" style="background: #007aff; color: white; font-weight: 600;">J</div>
                    <div class="list-content">
                        <div class="list-title">John Smith</div>
                        <div class="list-subtitle">(555) 123-4567</div>
                    </div>
                    <div class="contact-actions" style="display: flex; gap: 4px;">
                        <button onclick="event.stopPropagation(); removeContact('john')" style="background: #ff3b30; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 11px;">Remove</button>
                    </div>
                </div>
                <div class="list-item contact-item" onclick="showContactDetail('mary')" data-contact="mary" data-phone="(555) 987-6543">
                    <div class="contacts-selection-checkbox" style="display: none; margin-right: 12px; width: 20px; height: 20px; border: 2px solid #007aff; border-radius: 4px; position: relative;">
                        <div class="checkmark" style="display: none; position: absolute; top: 2px; left: 6px; width: 6px; height: 10px; border: solid white; border-width: 0 2px 2px 0; transform: rotate(45deg);"></div>
                    </div>
                    <div class="list-avatar" style="background: #007aff; color: white; font-weight: 600;">M</div>
                    <div class="list-content">
                        <div class="list-title">Mary Johnson</div>
                        <div class="list-subtitle">(555) 987-6543</div>
                    </div>
                    <div class="contact-actions" style="display: flex; gap: 4px;">
                        <button onclick="event.stopPropagation(); removeContact('mary')" style="background: #ff3b30; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 11px;">Remove</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Settings Screen -->
        <div class="screen" id="settings">
            <div class="list-item" onclick="showDetail('security')">
                <div class="list-avatar">🛡️</div>
                <div class="list-content">
                    <div class="list-title">Security Settings</div>
                    <div class="list-subtitle">PIN: 8322, Verbal: "Black widow"</div>
                </div>
                <div class="list-arrow">›</div>
            </div>
            <div class="list-item" onclick="showDetail('privacy')">
                <div class="list-avatar">🛡️</div>
                <div class="list-content">
                    <div class="list-title">Privacy Protection</div>
                    <div class="list-subtitle">Call Screening & Authentication</div>
                </div>
                <div class="list-arrow">›</div>
            </div>
            <div class="list-item" onclick="showDetail('about')">
                <div class="list-avatar">ℹ️</div>
                <div class="list-content">
                    <div class="list-title">About CallBunker</div>
                    <div class="list-subtitle">Version 1.0.0</div>
                </div>
                <div class="list-arrow">›</div>
            </div>
        </div>
        
        <!-- Security Detail Screen -->
        <div class="detail-screen" id="security-detail">
            <div class="detail-header">
                <button class="back-arrow" onclick="hideDetail()">‹</button>
                <div class="detail-title">Security Settings</div>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">PIN Authentication</div>
                <div style="display: flex; align-items: center; margin-top: 8px;" id="pin-display">
                    <div style="flex: 1; padding: 8px; background: #f8f9fa; border-radius: 6px; font-size: 16px; margin-right: 8px; color: #1c1c1e;" id="pin-value">8322</div>
                    <button onclick="editPin()" style="background: #007aff; color: white; border: none; border-radius: 6px; padding: 8px 12px; font-size: 14px;">Edit</button>
                </div>
                <div style="display: none; align-items: center; margin-top: 8px;" id="pin-edit">
                    <input type="text" id="pin-input" value="8322" style="flex: 1; padding: 8px; border: 1px solid #e5e5ea; border-radius: 6px; font-size: 16px; margin-right: 8px;">
                    <button onclick="savePin()" style="background: #4caf50; color: white; border: none; border-radius: 6px; padding: 8px 12px; font-size: 14px; margin-right: 4px;">Save</button>
                    <button onclick="cancelPinEdit()" style="background: #8e8e93; color: white; border: none; border-radius: 6px; padding: 8px 12px; font-size: 14px;">Cancel</button>
                </div>
                <div style="font-size: 12px; color: #8e8e93; margin-top: 4px;">4-digit numeric code for call authentication</div>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Verbal Code</div>
                <div style="display: flex; align-items: center; margin-top: 8px;" id="verbal-display">
                    <div style="flex: 1; padding: 8px; background: #f8f9fa; border-radius: 6px; font-size: 16px; margin-right: 8px; color: #1c1c1e;" id="verbal-value">"Black widow"</div>
                    <button onclick="editVerbal()" style="background: #007aff; color: white; border: none; border-radius: 6px; padding: 8px 12px; font-size: 14px;">Edit</button>
                </div>
                <div style="display: none; align-items: center; margin-top: 8px;" id="verbal-edit">
                    <input type="text" id="verbal-input" value="Black widow" style="flex: 1; padding: 8px; border: 1px solid #e5e5ea; border-radius: 6px; font-size: 16px; margin-right: 8px;">
                    <button onclick="saveVerbal()" style="background: #4caf50; color: white; border: none; border-radius: 6px; padding: 8px 12px; font-size: 14px; margin-right: 4px;">Save</button>
                    <button onclick="cancelVerbalEdit()" style="background: #8e8e93; color: white; border: none; border-radius: 6px; padding: 8px 12px; font-size: 14px;">Cancel</button>
                </div>
                <div style="font-size: 12px; color: #8e8e93; margin-top: 4px;">Spoken phrase for voice authentication</div>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Authentication Methods</div>
                <ul class="feature-list">
                    <li class="feature-item">
                        <span class="feature-icon">🔢</span>
                        <span class="feature-text">PIN Code Entry</span>
                    </li>
                    <li class="feature-item">
                        <span class="feature-icon">🗣️</span>
                        <span class="feature-text">Verbal Recognition</span>
                    </li>
                    <li class="feature-item">
                        <span class="feature-icon">⚡</span>
                        <span class="feature-text">Dual Verification Support</span>
                    </li>
                </ul>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Security Features</div>
                <ul class="feature-list">
                    <li class="feature-item">
                        <span class="feature-icon">🛡️</span>
                        <span class="feature-text">Call Screening Protection</span>
                    </li>
                    <li class="feature-item">
                        <span class="feature-icon">📱</span>
                        <span class="feature-text">Rate Limiting & Blocking</span>
                    </li>
                    <li class="feature-item">
                        <span class="feature-icon">✅</span>
                        <span class="feature-text">Smart Trusted Caller Whitelist</span>
                    </li>
                </ul>
            </div>
        </div>
        
        <!-- Privacy Detail Screen -->
        <div class="detail-screen" id="privacy-detail">
            <div class="detail-header">
                <button class="back-arrow" onclick="hideDetail()">‹</button>
                <div class="detail-title">Privacy Protection</div>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Defense Number</div>
                <div class="detail-value">+1 (617) 942-1250</div>
                <div style="font-size: 12px; color: #8e8e93; margin-top: 4px;">Your protected communication number</div>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Call Screening Status</div>
                <div style="display: flex; align-items: center; margin-top: 8px;">
                    <span style="color: #4caf50; font-size: 18px; margin-right: 8px;">✅</span>
                    <span style="color: #4caf50; font-weight: 500;">Active Protection</span>
                </div>
                <div style="font-size: 12px; color: #8e8e93; margin-top: 4px;">All incoming calls are authenticated before connecting</div>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Authentication Methods</div>
                <ul class="feature-list">
                    <li class="feature-item">
                        <span class="feature-icon">🔢</span>
                        <span class="feature-text">PIN Code Verification</span>
                        <span style="color: #4caf50; margin-left: auto;">ACTIVE</span>
                    </li>
                    <li class="feature-item">
                        <span class="feature-icon">🗣️</span>
                        <span class="feature-text">Voice Recognition</span>
                        <span style="color: #4caf50; margin-left: auto;">ACTIVE</span>
                    </li>
                    <li class="feature-item">
                        <span class="feature-icon">📝</span>
                        <span class="feature-text">Trusted Contacts Bypass</span>
                        <span style="color: #4caf50; margin-left: auto;">ENABLED</span>
                    </li>
                    <li class="feature-item">
                        <span class="feature-icon">🚫</span>
                        <span class="feature-text">Auto-Block Failed Attempts</span>
                        <span style="color: #4caf50; margin-left: auto;">ENABLED</span>
                    </li>
                </ul>
            </div>
            
            <div class="detail-card">
                <div style="background: #e8f5e8; padding: 12px; border-radius: 8px; display: flex; align-items: center;">
                    <span style="color: #4caf50; font-size: 20px; margin-right: 8px;">🛡️</span>
                    <span style="color: #4caf50; font-size: 14px;">Advanced call screening protects you from unwanted callers</span>
                </div>
            </div>
        </div>
        
        <!-- About Detail Screen -->
        <div class="detail-screen" id="about-detail">
            <div class="detail-header">
                <button class="back-arrow" onclick="hideDetail()">‹</button>
                <div class="detail-title">About CallBunker</div>
            </div>
            
            <div class="detail-card">
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 48px; margin-bottom: 12px;">🛡️</div>
                    <div style="font-size: 20px; font-weight: 600; color: #1c1c1e; margin-bottom: 4px;">CallBunker</div>
                    <div style="font-size: 14px; color: #8e8e93;">Advanced Communication Security</div>
                </div>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Version Information</div>
                <div class="detail-value">1.0.0</div>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Core Features</div>
                <ul class="feature-list">
                    <li class="feature-item">
                        <span class="feature-icon">🛡️</span>
                        <span class="feature-text">Call Screening with PIN/Verbal Auth</span>
                    </li>
                    <li class="feature-item">
                        <span class="feature-icon">📞</span>
                        <span class="feature-text">Protected Native Calling</span>
                    </li>
                    <li class="feature-item">
                        <span class="feature-icon">💬</span>
                        <span class="feature-text">Secure Messaging (Coming Soon)</span>
                    </li>
                    <li class="feature-item">
                        <span class="feature-icon">👥</span>
                        <span class="feature-text">Trusted Contacts Management</span>
                    </li>
                    <li class="feature-item">
                        <span class="feature-icon">📊</span>
                        <span class="feature-text">Call History & Analytics</span>
                    </li>
                </ul>
            </div>
            

            
            <div class="detail-card">
                <div style="text-align: center; color: #8e8e93; font-size: 12px; line-height: 1.4;">
                    CallBunker provides comprehensive communication security through advanced call screening, privacy protection, and intelligent contact management. Your real phone number stays completely hidden while maintaining full functionality.
                </div>
            </div>
        </div>
        
        <!-- Analytics Detail Screen -->
        <div class="detail-screen" id="analytics-detail">
            <div class="detail-header">
                <button class="back-arrow" onclick="hideAnalytics()">‹</button>
                <div class="detail-title">Security Analytics</div>
            </div>
            
            <div class="detail-card">
                <div style="text-align: center; padding: 16px;">
                    <div style="font-size: 48px; color: #4caf50; margin-bottom: 12px;">🛡️</div>
                    <div style="font-size: 20px; font-weight: 600; color: #1c1c1e; margin-bottom: 4px;">Privacy Protection Active</div>
                    <div style="font-size: 14px; color: #8e8e93;">Your real number stays completely hidden</div>
                </div>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Call Statistics (Last 30 Days)</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 12px;">
                    <div style="text-align: center;">
                        <div style="font-size: 28px; font-weight: bold; color: #4caf50;">5</div>
                        <div style="font-size: 12px; color: #8e8e93;">Protected Calls</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 28px; font-weight: bold; color: #007aff;">12</div>
                        <div style="font-size: 12px; color: #8e8e93;">Total Calls</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 28px; font-weight: bold; color: #ff9500;">7</div>
                        <div style="font-size: 12px; color: #8e8e93;">Screened Calls</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 28px; font-weight: bold; color: #ff3b30;">3</div>
                        <div style="font-size: 12px; color: #8e8e93;">Blocked Attempts</div>
                    </div>
                </div>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Protection Effectiveness</div>
                <div style="margin-top: 12px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <span style="font-size: 14px; color: #1c1c1e;">Privacy Success Rate</span>
                        <span style="font-size: 14px; font-weight: 600; color: #4caf50;">100%</span>
                    </div>
                    <div style="height: 6px; background: #f2f2f7; border-radius: 3px; overflow: hidden;">
                        <div style="height: 100%; width: 100%; background: #4caf50; border-radius: 3px;"></div>
                    </div>
                </div>
                <div style="margin-top: 16px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <span style="font-size: 14px; color: #1c1c1e;">Authentication Rate</span>
                        <span style="font-size: 14px; font-weight: 600; color: #4caf50;">71%</span>
                    </div>
                    <div style="height: 6px; background: #f2f2f7; border-radius: 3px; overflow: hidden;">
                        <div style="height: 100%; width: 71%; background: #4caf50; border-radius: 3px;"></div>
                    </div>
                </div>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Recent Activity</div>
                <ul class="feature-list">
                    <li class="feature-item">
                        <span class="feature-icon" style="color: #4caf50;">📞</span>
                        <div>
                            <div class="feature-text">Protected call to (555) 123-4567</div>
                            <div style="font-size: 12px; color: #8e8e93;">2 hours ago</div>
                        </div>
                    </li>
                    <li class="feature-item">
                        <span class="feature-icon" style="color: #ff9500;">🛡️</span>
                        <div>
                            <div class="feature-text">Call screening: PIN verified</div>
                            <div style="font-size: 12px; color: #8e8e93;">5 hours ago</div>
                        </div>
                    </li>
                    <li class="feature-item">
                        <span class="feature-icon" style="color: #ff3b30;">🚫</span>
                        <div>
                            <div class="feature-text">Blocked unknown caller</div>
                            <div style="font-size: 12px; color: #8e8e93;">1 day ago</div>
                        </div>
                    </li>
                </ul>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Security Features Active</div>
                <ul class="feature-list">
                    <li class="feature-item">
                        <span class="feature-icon">🔢</span>
                        <span class="feature-text">PIN Authentication</span>
                        <span style="color: #4caf50; margin-left: auto;">✓</span>
                    </li>
                    <li class="feature-item">
                        <span class="feature-icon">🗣️</span>
                        <span class="feature-text">Voice Recognition</span>
                        <span style="color: #4caf50; margin-left: auto;">✓</span>
                    </li>
                    <li class="feature-item">
                        <span class="feature-icon">🛡️</span>
                        <span class="feature-text">Call Screening</span>
                        <span style="color: #4caf50; margin-left: auto;">✓</span>
                    </li>
                </ul>
            </div>
            
            <div class="detail-card">
                <div style="margin-bottom: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <div class="detail-label">Blocked Calls (6)</div>
                        <div id="blocked-actions" style="display: flex; gap: 8px; align-items: center;">
                            <button onclick="selectAllBlocked()" style="background: #007aff; color: white; border: none; border-radius: 6px; padding: 6px 12px; font-size: 12px;">Select All</button>
                        </div>
                        <div id="selection-actions" style="display: none;">
                            <span id="selection-count" style="font-size: 12px; color: #8e8e93; margin-right: 8px;">0 selected</span>
                            <button onclick="cancelSelection()" style="background: #8e8e93; color: white; border: none; border-radius: 6px; padding: 6px 12px; font-size: 12px; margin-right: 4px;">Cancel</button>
                            <button onclick="whitelistSelected()" style="background: #4caf50; color: white; border: none; border-radius: 6px; padding: 6px 12px; font-size: 12px; margin-right: 4px;">Whitelist Selected</button>
                            <button onclick="removeSelected()" style="background: #ff3b30; color: white; border: none; border-radius: 6px; padding: 6px 12px; font-size: 12px;">Remove Selected</button>
                        </div>
                    </div>
                    <div id="multi-select-container" style="text-align: center; padding: 8px 0; border-top: 1px solid #e5e5ea;">
                        <!-- Multi-select button will be added here dynamically -->
                    </div>
                </div>
                <div id="blocked-calls-list">
                    <div class="list-item blocked-call-item" style="margin-bottom: 8px; padding: 12px;" data-phone="(555) 999-8888">
                        <div class="selection-checkbox" style="display: none; margin-right: 12px; width: 20px; height: 20px; border: 2px solid #007aff; border-radius: 4px; position: relative;">
                            <div class="checkmark" style="display: none; position: absolute; top: 2px; left: 6px; width: 6px; height: 10px; border: solid white; border-width: 0 2px 2px 0; transform: rotate(45deg);"></div>
                        </div>
                        <div class="list-avatar" style="background: #ff3b30; color: white; font-size: 16px;">🚫</div>
                        <div class="list-content" style="position: relative;">
                            <div class="list-title">(555) 999-8888</div>
                            <div class="list-subtitle">Blocked 2 hours ago • Failed authentication</div>
                        </div>
                        <div class="item-actions" style="display: flex; gap: 4px;">
                            <button onclick="whitelistCall('(555) 999-8888')" style="background: #4caf50; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 11px;">Whitelist</button>
                            <button onclick="removeBlocked('(555) 999-8888')" style="background: #8e8e93; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 11px;">Remove</button>
                        </div>
                    </div>
                    
                    <div class="list-item blocked-call-item" style="margin-bottom: 8px; padding: 12px;" data-phone="(555) 123-0000">
                        <div class="selection-checkbox" style="display: none; margin-right: 12px; width: 20px; height: 20px; border: 2px solid #007aff; border-radius: 4px; position: relative;">
                            <div class="checkmark" style="display: none; position: absolute; top: 2px; left: 6px; width: 6px; height: 10px; border: solid white; border-width: 0 2px 2px 0; transform: rotate(45deg);"></div>
                        </div>
                        <div class="list-avatar" style="background: #ff3b30; color: white; font-size: 16px;">🚫</div>
                        <div class="list-content" style="position: relative;">
                            <div class="list-title">(555) 123-0000</div>
                            <div class="list-subtitle">Blocked 1 day ago • Unknown caller</div>
                        </div>
                        <div class="item-actions" style="display: flex; gap: 4px;">
                            <button onclick="whitelistCall('(555) 123-0000')" style="background: #4caf50; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 11px;">Whitelist</button>
                            <button onclick="removeBlocked('(555) 123-0000')" style="background: #8e8e93; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 11px;">Remove</button>
                        </div>
                    </div>
                    
                    <div class="list-item blocked-call-item" style="margin-bottom: 8px; padding: 12px;" data-phone="(555) 777-4444">
                        <div class="selection-checkbox" style="display: none; margin-right: 12px; width: 20px; height: 20px; border: 2px solid #007aff; border-radius: 4px; position: relative;">
                            <div class="checkmark" style="display: none; position: absolute; top: 2px; left: 6px; width: 6px; height: 10px; border: solid white; border-width: 0 2px 2px 0; transform: rotate(45deg);"></div>
                        </div>
                        <div class="list-avatar" style="background: #ff3b30; color: white; font-size: 16px;">🚫</div>
                        <div class="list-content" style="position: relative;">
                            <div class="list-title">(555) 777-4444</div>
                            <div class="list-subtitle">Blocked 3 days ago • Spam detected</div>
                        </div>
                        <div class="item-actions" style="display: flex; gap: 4px;">
                            <button onclick="whitelistCall('(555) 777-4444')" style="background: #4caf50; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 11px;">Whitelist</button>
                            <button onclick="removeBlocked('(555) 777-4444')" style="background: #8e8e93; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 11px;">Remove</button>
                        </div>
                    </div>
                    
                    <div class="list-item blocked-call-item" style="margin-bottom: 8px; padding: 12px;" data-phone="(555) 234-5678">
                        <div class="selection-checkbox" style="display: none; margin-right: 12px; width: 20px; height: 20px; border: 2px solid #007aff; border-radius: 4px; position: relative;">
                            <div class="checkmark" style="display: none; position: absolute; top: 2px; left: 6px; width: 6px; height: 10px; border: solid white; border-width: 0 2px 2px 0; transform: rotate(45deg);"></div>
                        </div>
                        <div class="list-avatar" style="background: #ff3b30; color: white; font-size: 16px;">🚫</div>
                        <div class="list-content" style="position: relative;">
                            <div class="list-title">(555) 234-5678</div>
                            <div class="list-subtitle">Blocked 5 hours ago • Invalid PIN</div>
                        </div>
                        <div class="item-actions" style="display: flex; gap: 4px;">
                            <button onclick="whitelistCall('(555) 234-5678')" style="background: #4caf50; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 11px;">Whitelist</button>
                            <button onclick="removeBlocked('(555) 234-5678')" style="background: #8e8e93; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 11px;">Remove</button>
                        </div>
                    </div>
                    
                    <div class="list-item blocked-call-item" style="margin-bottom: 8px; padding: 12px;" data-phone="(555) 876-5432">
                        <div class="selection-checkbox" style="display: none; margin-right: 12px; width: 20px; height: 20px; border: 2px solid #007aff; border-radius: 4px; position: relative;">
                            <div class="checkmark" style="display: none; position: absolute; top: 2px; left: 6px; width: 6px; height: 10px; border: solid white; border-width: 0 2px 2px 0; transform: rotate(45deg);"></div>
                        </div>
                        <div class="list-avatar" style="background: #ff3b30; color: white; font-size: 16px;">🚫</div>
                        <div class="list-content" style="position: relative;">
                            <div class="list-title">(555) 876-5432</div>
                            <div class="list-subtitle">Blocked 30 minutes ago • Suspicious activity</div>
                        </div>
                        <div class="item-actions" style="display: flex; gap: 4px;">
                            <button onclick="whitelistCall('(555) 876-5432')" style="background: #4caf50; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 11px;">Whitelist</button>
                            <button onclick="removeBlocked('(555) 876-5432')" style="background: #8e8e93; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 11px;">Remove</button>
                        </div>
                    </div>
                    
                    <div class="list-item blocked-call-item" style="margin-bottom: 8px; padding: 12px;" data-phone="(555) 321-9876">
                        <div class="selection-checkbox" style="display: none; margin-right: 12px; width: 20px; height: 20px; border: 2px solid #007aff; border-radius: 4px; position: relative;">
                            <div class="checkmark" style="display: none; position: absolute; top: 2px; left: 6px; width: 6px; height: 10px; border: solid white; border-width: 0 2px 2px 0; transform: rotate(45deg);"></div>
                        </div>
                        <div class="list-avatar" style="background: #ff3b30; color: white; font-size: 16px;">🚫</div>
                        <div class="list-content" style="position: relative;">
                            <div class="list-title">(555) 321-9876</div>
                            <div class="list-subtitle">Blocked 15 minutes ago • Too many attempts</div>
                        </div>
                        <div class="item-actions" style="display: flex; gap: 4px;">
                            <button onclick="whitelistCall('(555) 321-9876')" style="background: #4caf50; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 11px;">Whitelist</button>
                            <button onclick="removeBlocked('(555) 321-9876')" style="background: #8e8e93; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 11px;">Remove</button>
                        </div>
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin-top: 12px;">
                    <div style="font-size: 12px; color: #8e8e93; text-align: center;">
                        <span id="selection-hint" style="display: none;">Tap calls to select/deselect • </span>

                        Blocked calls are automatically removed after 30 days
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Contact Detail Screens -->
        <div class="detail-screen" id="john-detail">
            <div class="detail-header">
                <button class="back-arrow" onclick="hideContactDetail()">‹</button>
                <div class="detail-title">John Smith</div>
            </div>
            
            <div class="detail-card">
                <div style="text-align: center; padding: 16px;">
                    <div class="list-avatar" style="background: #007aff; color: white; font-weight: 600; font-size: 24px; width: 60px; height: 60px; margin: 0 auto 12px;">J</div>
                    <div style="font-size: 18px; font-weight: 600; color: #1c1c1e; margin-bottom: 4px;">John Smith</div>
                    <div style="font-size: 14px; color: #8e8e93;">(555) 123-4567</div>
                </div>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Trust Status</div>
                <div style="display: flex; align-items: center; margin-top: 8px;">
                    <span style="color: #4caf50; font-size: 18px; margin-right: 8px;">✅</span>
                    <span style="color: #4caf50; font-weight: 500;">Trusted Contact</span>
                </div>
                <div style="font-size: 12px; color: #8e8e93; margin-top: 4px;">Bypasses call screening automatically</div>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Contact Settings</div>
                <ul class="feature-list">
                    <li class="feature-item">
                        <span class="feature-icon">🛡️</span>
                        <span class="feature-text">Auto-bypass call screening</span>
                        <span style="color: #4caf50; margin-left: auto;">ON</span>
                    </li>
                    <li class="feature-item">
                        <span class="feature-icon">📞</span>
                        <span class="feature-text">Direct call forwarding</span>
                        <span style="color: #4caf50; margin-left: auto;">ON</span>
                    </li>
                    <li class="feature-item">
                        <span class="feature-icon">💬</span>
                        <span class="feature-text">SMS notifications</span>
                        <span style="color: #4caf50; margin-left: auto;">ON</span>
                    </li>
                </ul>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Custom PIN</div>
                <div class="detail-value">Not Set</div>
                <div style="font-size: 12px; color: #8e8e93; margin-top: 4px;">Optional override PIN for this contact</div>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Added to Whitelist</div>
                <div class="detail-value">March 15, 2024</div>
            </div>
            
            <div style="padding: 16px;">
                <button style="width: 100%; background: #ff3b30; color: white; border: none; border-radius: 8px; padding: 12px; font-size: 16px; font-weight: 500;">Remove from Trusted Contacts</button>
            </div>
        </div>
        
        <div class="detail-screen" id="mary-detail">
            <div class="detail-header">
                <button class="back-arrow" onclick="hideContactDetail()">‹</button>
                <div class="detail-title">Mary Johnson</div>
            </div>
            
            <div class="detail-card">
                <div style="text-align: center; padding: 16px;">
                    <div class="list-avatar" style="background: #007aff; color: white; font-weight: 600; font-size: 24px; width: 60px; height: 60px; margin: 0 auto 12px;">M</div>
                    <div style="font-size: 18px; font-weight: 600; color: #1c1c1e; margin-bottom: 4px;">Mary Johnson</div>
                    <div style="font-size: 14px; color: #8e8e93;">(555) 987-6543</div>
                </div>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Trust Status</div>
                <div style="display: flex; align-items: center; margin-top: 8px;">
                    <span style="color: #ff9500; font-size: 18px; margin-right: 8px;">⚙️</span>
                    <span style="color: #ff9500; font-weight: 500;">Partial Trust</span>
                </div>
                <div style="font-size: 12px; color: #8e8e93; margin-top: 4px;">Requires PIN verification to bypass screening</div>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Contact Settings</div>
                <ul class="feature-list">
                    <li class="feature-item">
                        <span class="feature-icon">🛡️</span>
                        <span class="feature-text">Auto-bypass call screening</span>
                        <span style="color: #8e8e93; margin-left: auto;">OFF</span>
                    </li>
                    <li class="feature-item">
                        <span class="feature-icon">📞</span>
                        <span class="feature-text">PIN-based forwarding</span>
                        <span style="color: #4caf50; margin-left: auto;">ON</span>
                    </li>
                    <li class="feature-item">
                        <span class="feature-icon">💬</span>
                        <span class="feature-text">SMS notifications</span>
                        <span style="color: #4caf50; margin-left: auto;">ON</span>
                    </li>
                </ul>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Custom PIN</div>
                <div class="detail-value">1234</div>
                <div style="font-size: 12px; color: #8e8e93; margin-top: 4px;">Required for call screening bypass</div>
            </div>
            
            <div class="detail-card">
                <div class="detail-label">Added to Whitelist</div>
                <div class="detail-value">April 2, 2024</div>
            </div>
            
            <div style="padding: 16px; display: flex; gap: 12px;">
                <button style="flex: 1; background: #4caf50; color: white; border: none; border-radius: 8px; padding: 12px; font-size: 14px; font-weight: 500;">Grant Full Trust</button>
                <button style="flex: 1; background: #ff3b30; color: white; border: none; border-radius: 8px; padding: 12px; font-size: 14px; font-weight: 500;">Remove Contact</button>
            </div>
        </div>
    </div>
    
    <div class="tab-bar">
        <div class="tab active" onclick="switchTab('home'); return false;">
            <div class="tab-icon">🏠</div>
            <div class="tab-label">Home</div>
        </div>
        <div class="tab" onclick="switchTab('dialer'); return false;">
            <div class="tab-icon">📞</div>
            <div class="tab-label">Dialer</div>
        </div>
        <div class="tab" onclick="switchTab('messages'); return false;">
            <div class="tab-icon">💬</div>
            <div class="tab-label">Messages</div>
        </div>
        <div class="tab" onclick="switchTab('history'); return false;">
            <div class="tab-icon">📋</div>
            <div class="tab-label">History</div>
        </div>
        <div class="tab" onclick="switchTab('contacts'); return false;">
            <div class="tab-icon">👥</div>
            <div class="tab-label">Contacts</div>
        </div>
        <div class="tab" onclick="switchTab('settings'); return false;">
            <div class="tab-icon">⚙️</div>
            <div class="tab-label">Settings</div>
        </div>
    </div>

    <!-- Custom Modal Overlay -->
    <div id="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div id="modal-content" style="background: white; border-radius: 12px; padding: 24px; margin: 20px; max-width: 320px; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
            <div id="modal-title" style="font-size: 18px; font-weight: 600; color: #1c1c1e; margin-bottom: 12px;"></div>
            <div id="modal-message" style="font-size: 14px; color: #8e8e93; margin-bottom: 24px; line-height: 1.4;"></div>
            <div id="modal-buttons" style="display: flex; gap: 12px;">
                <!-- Buttons will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        let phoneNumber = '';
        
        const titles = {
            home: 'CallBunker',
            dialer: 'Protected Dialer',
            messages: 'Messages',
            history: 'Call History',
            contacts: 'Trusted Contacts',
            settings: 'Settings'
        };
        
        function switchTab(tab) {
            // Prevent any browser navigation
            event.preventDefault();
            event.stopPropagation();
            
            // Hide all screens and detail screens
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.detail-screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            
            // Show selected screen
            document.getElementById(tab).classList.add('active');
            document.querySelector(`[onclick="switchTab('${tab}')"]`).classList.add('active');
            
            // Update title
            document.getElementById('screen-title').textContent = titles[tab];
            
            return false;
        }
        
        function addDigit(digit) {
            phoneNumber += digit;
            updateDisplay();
        }
        
        function backspace() {
            phoneNumber = phoneNumber.slice(0, -1);
            updateDisplay();
        }
        
        function updateDisplay() {
            const display = document.getElementById('phone-display');
            if (phoneNumber) {
                display.textContent = formatPhone(phoneNumber);
                display.style.color = '#1c1c1e';
            } else {
                display.textContent = 'Enter number';
                display.style.color = '#c7c7cc';
            }
        }
        
        function formatPhone(number) {
            const cleaned = number.replace(/\D/g, '');
            const match = cleaned.match(/^(\d{0,3})(\d{0,3})(\d{0,4})$/);
            if (match) {
                return [match[1], match[2], match[3]].filter(Boolean).join('-');
            }
            return number;
        }
        
        function makeCall() {
            if (phoneNumber) {
                showCustomConfirm(
                    'Protected Call',
                    'Call ' + phoneNumber + '? Your Google Voice number will be shown as caller ID. Your real number stays hidden.',
                    'Call Now',
                    'Cancel',
                    function() {
                        showCustomAlert('Calling...', 'Initiating protected call to ' + phoneNumber);
                    }
                );
            } else {
                showCustomAlert('Enter Number', 'Please enter a phone number to call.');
            }
        }
        
        function showDetail(detailType) {
            // Prevent any browser navigation
            event.preventDefault();
            event.stopPropagation();
            
            // Hide main settings screen
            document.getElementById('settings').classList.remove('active');
            
            // Show detail screen
            document.getElementById(detailType + '-detail').classList.add('active');
            
            // Update header title
            const titles = {
                security: 'Security Settings',
                privacy: 'Privacy Protection', 
                about: 'About CallBunker'
            };
            document.getElementById('screen-title').textContent = titles[detailType];
            
            return false;
        }
        
        function hideDetail() {
            // Hide all detail screens
            document.querySelectorAll('.detail-screen').forEach(s => s.classList.remove('active'));
            
            // Show main settings screen
            document.getElementById('settings').classList.add('active');
            
            // Update header title
            document.getElementById('screen-title').textContent = 'Settings';
        }
        
        function showContactDetail(contactId) {
            // Hide main contacts screen
            document.getElementById('contacts').classList.remove('active');
            
            // Show contact detail screen
            document.getElementById(contactId + '-detail').classList.add('active');
            
            // Update header title
            const titles = {
                john: 'John Smith',
                mary: 'Mary Johnson'
            };
            document.getElementById('screen-title').textContent = titles[contactId];
        }
        
        function hideContactDetail() {
            // Hide all contact detail screens
            document.querySelectorAll('.detail-screen').forEach(s => s.classList.remove('active'));
            
            // Show main contacts screen
            document.getElementById('contacts').classList.add('active');
            
            // Update header title
            document.getElementById('screen-title').textContent = 'Trusted Contacts';
        }
        
        function editPin() {
            document.getElementById('pin-display').style.display = 'none';
            document.getElementById('pin-edit').style.display = 'flex';
            document.getElementById('pin-input').focus();
        }
        
        function savePin() {
            const newPin = document.getElementById('pin-input').value;
            if (newPin && /^\d{4}$/.test(newPin)) {
                document.getElementById('pin-value').textContent = newPin;
                document.getElementById('pin-display').style.display = 'flex';
                document.getElementById('pin-edit').style.display = 'none';
                showCustomAlert('PIN Updated', 'Your new PIN ' + newPin + ' will be used for call authentication.');
                updateSettingsDisplay();
            } else {
                showCustomAlert('Invalid PIN', 'Please enter a valid 4-digit PIN number.');
                document.getElementById('pin-input').focus();
            }
        }
        
        function cancelPinEdit() {
            const currentPin = document.getElementById('pin-value').textContent;
            document.getElementById('pin-input').value = currentPin;
            document.getElementById('pin-display').style.display = 'flex';
            document.getElementById('pin-edit').style.display = 'none';
        }
        
        function editVerbal() {
            document.getElementById('verbal-display').style.display = 'none';
            document.getElementById('verbal-edit').style.display = 'flex';
            document.getElementById('verbal-input').focus();
        }
        
        function saveVerbal() {
            const newVerbal = document.getElementById('verbal-input').value.trim();
            if (newVerbal && newVerbal.length >= 3) {
                document.getElementById('verbal-value').textContent = '"' + newVerbal + '"';
                document.getElementById('verbal-display').style.display = 'flex';
                document.getElementById('verbal-edit').style.display = 'none';
                showCustomAlert('Verbal Code Updated', 'Your new code "' + newVerbal + '" will be used for voice authentication.');
                updateSettingsDisplay();
            } else {
                showCustomAlert('Invalid Code', 'Please enter a verbal code with at least 3 characters.');
                document.getElementById('verbal-input').focus();
            }
        }
        
        function cancelVerbalEdit() {
            const currentVerbal = document.getElementById('verbal-value').textContent.replace(/"/g, '');
            document.getElementById('verbal-input').value = currentVerbal;
            document.getElementById('verbal-display').style.display = 'flex';
            document.getElementById('verbal-edit').style.display = 'none';
        }
        
        function updateSettingsDisplay() {
            // Update the PIN and verbal code display in the main settings list
            const pin = document.getElementById('pin-value').textContent;
            const verbal = document.getElementById('verbal-value').textContent.replace(/"/g, '');
            
            // Find and update the settings subtitle
            const settingsItems = document.querySelectorAll('#settings .list-subtitle');
            settingsItems.forEach(item => {
                if (item.textContent.includes('PIN:')) {
                    item.textContent = `PIN: ${pin}, Verbal: "${verbal}"`;
                }
            });
        }
        
        function showAnalytics() {
            // Prevent any browser navigation
            event.preventDefault();
            event.stopPropagation();
            
            // Update analytics with real data
            updateAnalyticsWithRealData();
            
            // Hide main home screen
            document.getElementById('home').classList.remove('active');
            
            // Show analytics detail screen
            document.getElementById('analytics-detail').classList.add('active');
            
            // Update header title
            document.getElementById('screen-title').textContent = 'Security Analytics';
            
            return false;
        }
        
        function updateAnalyticsWithRealData() {
            const blockedCalls = document.querySelectorAll('.blocked-call-item').length;
            const trustedContacts = getTrustedContactsCount();
            const screenedCalls = Math.max(0, blockedCalls * 2); // Calls that went through screening but passed
            const totalCalls = blockedCalls + trustedContacts + screenedCalls; // All call activity
            const protectedCalls = trustedContacts + screenedCalls; // Successful calls (trusted + authenticated)
            const authRate = totalCalls > 0 ? Math.round((protectedCalls / totalCalls) * 100) : 100;
            
            // Update call statistics
            const statsGrid = document.querySelector('#analytics-detail .detail-card:nth-child(3) div[style*="grid-template-columns"]');
            if (statsGrid) {
                statsGrid.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 28px; font-weight: bold; color: #4caf50;">${protectedCalls}</div>
                        <div style="font-size: 12px; color: #8e8e93;">Protected Calls</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 28px; font-weight: bold; color: #007aff;">${totalCalls}</div>
                        <div style="font-size: 12px; color: #8e8e93;">Total Calls</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 28px; font-weight: bold; color: #ff9500;">${screenedCalls}</div>
                        <div style="font-size: 12px; color: #8e8e93;">Screened Calls</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 28px; font-weight: bold; color: #ff3b30;">${blockedCalls}</div>
                        <div style="font-size: 12px; color: #8e8e93;">Blocked Attempts</div>
                    </div>
                `;
            }
            
            // Update authentication rate
            const authRateDisplay = document.querySelector('#analytics-detail .detail-card:nth-child(4) span[style*="color: #4caf50"]:nth-child(2)');
            if (authRateDisplay) {
                authRateDisplay.textContent = authRate + '%';
            }
            
            const authRateBar = document.querySelector('#analytics-detail .detail-card:nth-child(4) div[style*="width: 71%"]');
            if (authRateBar) {
                authRateBar.style.width = authRate + '%';
            }
            
            // Update recent activity with real blocked calls
            updateRecentActivityWithBlockedCalls();
        }
        
        function updateRecentActivityWithBlockedCalls() {
            const recentActivityList = document.querySelector('#analytics-detail .detail-card:nth-child(5) .feature-list');
            if (!recentActivityList) return;
            
            const blockedCallItems = document.querySelectorAll('.blocked-call-item');
            let activityHTML = '';
            
            // Add recent blocked calls (limit to 3 most recent)
            const recentBlocked = Array.from(blockedCallItems).slice(0, 3);
            recentBlocked.forEach((item, index) => {
                const phoneSpan = item.querySelector('.list-title');
                const phoneNumber = phoneSpan ? phoneSpan.textContent : 'Unknown';
                const hoursAgo = (index + 1) * 2; // Simulate different times
                
                activityHTML += `
                    <li class="feature-item">
                        <span class="feature-icon" style="color: #ff3b30;">🚫</span>
                        <div>
                            <div class="feature-text">Blocked call from ${phoneNumber}</div>
                            <div style="font-size: 12px; color: #8e8e93;">${hoursAgo} hours ago</div>
                        </div>
                    </li>
                `;
            });
            
            // Add some successful authentication events if we have trusted contacts
            const trustedCount = getTrustedContactsCount();
            if (trustedCount > 0) {
                activityHTML += `
                    <li class="feature-item">
                        <span class="feature-icon" style="color: #4caf50;">✅</span>
                        <div>
                            <div class="feature-text">Trusted contact bypassed screening</div>
                            <div style="font-size: 12px; color: #8e8e93;">6 hours ago</div>
                        </div>
                    </li>
                `;
            }
            
            // Add PIN verification if we have blocked calls (someone successfully authenticated)
            if (blockedCallItems.length > 0) {
                activityHTML += `
                    <li class="feature-item">
                        <span class="feature-icon" style="color: #ff9500;">🛡️</span>
                        <div>
                            <div class="feature-text">Call screening: PIN verified</div>
                            <div style="font-size: 12px; color: #8e8e93;">8 hours ago</div>
                        </div>
                    </li>
                `;
            }
            
            // If no activity, show default message
            if (!activityHTML) {
                activityHTML = `
                    <li class="feature-item">
                        <span class="feature-icon" style="color: #8e8e93;">📊</span>
                        <div>
                            <div class="feature-text">No recent call activity</div>
                            <div style="font-size: 12px; color: #8e8e93;">Waiting for calls...</div>
                        </div>
                    </li>
                `;
            }
            
            recentActivityList.innerHTML = activityHTML;
        }
        
        function hideAnalytics() {
            // Hide analytics detail screen
            document.getElementById('analytics-detail').classList.remove('active');
            
            // Show main home screen
            document.getElementById('home').classList.add('active');
            
            // Update header title
            document.getElementById('screen-title').textContent = 'CallBunker';
        }
        
        function whitelistCall(phoneNumber) {
            showCustomConfirm(
                'Add to Trusted Contacts?',
                phoneNumber + ' will bypass call screening in future calls.',
                'Add to Trusted',
                'Cancel',
                function() {
                    // Remove from blocked list
                    removeBlockedCallFromList(phoneNumber);
                    updateBlockedCallsCount();
                    
                    // Add to trusted contacts list
                    addToTrustedContacts(phoneNumber);
                    updateTrustedContactsCount();
                    
                    showCustomAlert('Success!', phoneNumber + ' has been added to your trusted contacts.');
                }
            );
        }
        

        
        function showDynamicContactDetail(phoneNumber, contactId) {
            // Hide main contacts screen
            document.getElementById('contacts').classList.remove('active');
            
            // Create or update dynamic contact detail screen
            let detailScreen = document.getElementById(contactId + '-detail');
            if (!detailScreen) {
                detailScreen = createContactDetailScreen(phoneNumber, contactId);
                document.querySelector('.content').appendChild(detailScreen);
            }
            
            // Show the detail screen
            detailScreen.classList.add('active');
            
            // Update header title
            document.getElementById('screen-title').textContent = phoneNumber;
        }
        
        function createContactDetailScreen(phoneNumber, contactId) {
            const detailScreen = document.createElement('div');
            detailScreen.className = 'detail-screen';
            detailScreen.id = contactId + '-detail';
            
            detailScreen.innerHTML = `
                <div class="detail-header">
                    <button class="back-arrow" onclick="hideDynamicContactDetail('${contactId}')">‹</button>
                    <div class="detail-title">${phoneNumber}</div>
                </div>
                
                <div class="detail-card">
                    <div class="detail-label">Phone Number</div>
                    <div class="detail-value">${phoneNumber}</div>
                    <div style="font-size: 12px; color: #8e8e93; margin-top: 4px;">Primary contact number</div>
                </div>
                
                <div class="detail-card">
                    <div class="detail-label">Trust Level</div>
                    <div class="detail-value">Trusted Contact</div>
                    <div style="font-size: 12px; color: #8e8e93; margin-top: 4px;">Bypasses call screening automatically</div>
                </div>
                
                <div class="detail-card">
                    <div class="detail-label">Added to Whitelist</div>
                    <div class="detail-value">${new Date().toLocaleDateString()}</div>
                </div>
                
                <div style="padding: 16px; display: flex; gap: 12px;">
                    <button onclick="editContactPin('${phoneNumber}')" style="flex: 1; background: #007aff; color: white; border: none; border-radius: 8px; padding: 12px; font-size: 14px; font-weight: 500;">Set Custom PIN</button>
                    <button onclick="removeFromTrustedContacts('${phoneNumber}', '${contactId}')" style="flex: 1; background: #ff3b30; color: white; border: none; border-radius: 8px; padding: 12px; font-size: 14px; font-weight: 500;">Remove Contact</button>
                </div>
            `;
            
            return detailScreen;
        }
        
        function hideDynamicContactDetail(contactId) {
            // Hide the contact detail screen
            document.getElementById(contactId + '-detail').classList.remove('active');
            
            // Show main contacts screen
            document.getElementById('contacts').classList.add('active');
            
            // Update header title
            document.getElementById('screen-title').textContent = 'Trusted Contacts';
        }
        
        function editContactPin(phoneNumber) {
            showCustomAlert('Feature Coming Soon', 'Custom PIN assignment for individual contacts will be available in a future update.');
        }
        
        function removeFromTrustedContacts(phoneNumber, contactId) {
            showCustomConfirm(
                'Remove from Trusted Contacts?',
                phoneNumber + ' will no longer bypass call screening.',
                'Remove',
                'Cancel',
                function() {
                    // Remove the contact from the list
                    const contactElement = document.querySelector(`[onclick*="${contactId}"]`);
                    if (contactElement) {
                        contactElement.remove();
                    }
                    
                    // Remove the detail screen
                    const detailScreen = document.getElementById(contactId + '-detail');
                    if (detailScreen) {
                        detailScreen.remove();
                    }
                    
                    // Update trusted contacts count
                    updateTrustedContactsCount();
                    
                    // Return to contacts screen
                    document.getElementById('contacts').classList.add('active');
                    document.getElementById('screen-title').textContent = 'Trusted Contacts';
                    
                    showCustomAlert('Removed', phoneNumber + ' has been removed from your trusted contacts.');
                }
            );
        }
        
        function removeBlocked(phoneNumber) {
            showCustomConfirm(
                'Remove from Blocked List?',
                'This will delete the block record for ' + phoneNumber,
                'Remove',
                'Cancel',
                function() {
                    removeBlockedCallFromList(phoneNumber);
                    updateBlockedCallsCount();
                    showCustomAlert('Removed', 'Blocked call has been removed from the list.');
                }
            );
        }
        
        function removeBlockedCallFromList(phoneNumber) {
            // Find and remove the blocked call item using data-phone attribute
            const item = document.querySelector(`[data-phone="${phoneNumber}"]`);
            if (item) {
                item.remove();
            }
        }
        
        function selectAllBlocked() {
            // Enter selection mode first
            if (!isSelectionMode) {
                enterSelectionMode();
            }
            
            // Select all blocked call items
            const blockedItems = document.querySelectorAll('.blocked-call-item');
            blockedItems.forEach(item => {
                const phoneNumber = item.getAttribute('data-phone');
                if (phoneNumber && !selectedCalls.has(phoneNumber)) {
                    selectedCalls.add(phoneNumber);
                    
                    // Update visual selection
                    const checkbox = item.querySelector('.selection-checkbox');
                    const checkmark = checkbox.querySelector('.checkmark');
                    checkbox.style.backgroundColor = '#007aff';
                    checkmark.style.display = 'block';
                    item.style.backgroundColor = '#e3f2fd';
                }
            });
            
            updateSelectionCount();
        }
        
        function updateBlockedCallsCount() {
            // Count remaining blocked call items (excluding empty state message)
            const remainingItems = document.querySelectorAll('.blocked-call-item').length;
            
            // Update the analytics detail header
            const detailLabels = document.querySelectorAll('.detail-label');
            detailLabels.forEach(label => {
                if (label && label.textContent && label.textContent.includes('Blocked Calls')) {
                    label.textContent = `Blocked Calls (${remainingItems})`;
                }
            });
            
            // Update the home screen stat
            const homeStatElement = document.getElementById('blocked-calls-stat');
            if (homeStatElement) {
                homeStatElement.textContent = remainingItems;
            }
            
            // If no items left, show empty state
            if (remainingItems === 0) {
                const blockedList = document.getElementById('blocked-calls-list');
                if (blockedList) {
                    blockedList.innerHTML = '<div style="text-align: center; padding: 20px; color: #8e8e93; font-size: 14px;">No blocked calls</div>';
                }
                
                // Hide multi-select button when no items
                const multiSelectBtn = document.getElementById('multi-select-btn');
                if (multiSelectBtn) {
                    multiSelectBtn.style.display = 'none';
                }
            } else {
                // Show multi-select button when items exist
                const multiSelectBtn = document.getElementById('multi-select-btn');
                if (multiSelectBtn) {
                    multiSelectBtn.style.display = 'inline-block';
                }
            }
        }
        
        function updateTrustedContactsCount() {
            // Count all list items in the contacts screen except the info banner
            const contactsScreen = document.getElementById('contacts');
            if (!contactsScreen) return;
            
            const allItems = contactsScreen.querySelectorAll('.list-item');
            const totalContacts = allItems.length;
            
            // Update the home screen stat
            const trustedStatElement = document.getElementById('trusted-contacts-stat');
            if (trustedStatElement) {
                trustedStatElement.textContent = totalContacts;
            }
        }
        
        // Custom modal functions
        function showCustomAlert(title, message) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            document.getElementById('modal-buttons').innerHTML = `
                <button onclick="hideModal()" style="flex: 1; background: #007aff; color: white; border: none; border-radius: 8px; padding: 12px; font-size: 16px; font-weight: 500;">OK</button>
            `;
            document.getElementById('modal-overlay').style.display = 'flex';
        }
        
        function showCustomConfirm(title, message, confirmText, cancelText, onConfirm) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            document.getElementById('modal-buttons').innerHTML = `
                <button onclick="hideModal()" style="flex: 1; background: #8e8e93; color: white; border: none; border-radius: 8px; padding: 12px; font-size: 16px; font-weight: 500;">${cancelText}</button>
                <button onclick="confirmAction()" style="flex: 1; background: #007aff; color: white; border: none; border-radius: 8px; padding: 12px; font-size: 16px; font-weight: 500;">${confirmText}</button>
            `;
            document.getElementById('modal-overlay').style.display = 'flex';
            window.currentConfirmAction = onConfirm;
        }
        
        function hideModal() {
            document.getElementById('modal-overlay').style.display = 'none';
            window.currentConfirmAction = null;
        }
        
        function confirmAction() {
            if (window.currentConfirmAction) {
                window.currentConfirmAction();
            }
            hideModal();
        }
        
        // Close modal when clicking overlay
        document.getElementById('modal-overlay').onclick = function(e) {
            if (e.target === this) {
                hideModal();
            }
        }
        
        // Multi-select functionality for blocked calls
        let isSelectionMode = false;
        let selectedCalls = new Set();
        
        // Add a visible multi-select button in its own dedicated container
        function addMultiSelectButton() {
            const multiSelectContainer = document.getElementById('multi-select-container');
            if (multiSelectContainer && !document.getElementById('multi-select-btn')) {
                const multiSelectBtn = document.createElement('button');
                multiSelectBtn.id = 'multi-select-btn';
                multiSelectBtn.textContent = 'Select Multiple';
                multiSelectBtn.style.cssText = 'background: #007aff; color: white; border: none; border-radius: 6px; padding: 8px 16px; font-size: 12px;';
                multiSelectBtn.onclick = function() {
                    enterSelectionMode();
                };
                multiSelectContainer.appendChild(multiSelectBtn);
            }
        }
        
        // Simple click-to-select when in selection mode
        function initializeClickSelection() {
            document.querySelectorAll('.blocked-call-item').forEach(item => {
                // Remove any existing event listeners by cloning
                const newItem = item.cloneNode(true);
                item.parentNode.replaceChild(newItem, item);
                
                // Add simple click handler for selection mode
                newItem.addEventListener('click', function(e) {
                    // Only allow normal button clicks when NOT in selection mode
                    if (!isSelectionMode) {
                        return; // Normal behavior
                    }
                    
                    // In selection mode: handle clicks on the item (not buttons)
                    if (e.target.tagName !== 'BUTTON' && e.target.closest('.item-actions') === null) {
                        e.preventDefault();
                        e.stopPropagation();
                        toggleItemSelection(newItem);
                    }
                });
            });
        }
        
        function enterSelectionMode() {
            isSelectionMode = true;
            selectedCalls.clear();
            
            // Show checkboxes and hide individual action buttons
            document.querySelectorAll('.blocked-call-item').forEach(item => {
                item.querySelector('.selection-checkbox').style.display = 'block';
                item.querySelector('.item-actions').style.display = 'none';
                item.style.backgroundColor = '#f8f9fa';
                item.style.cursor = 'pointer';
            });
            
            // Switch header actions and hide multi-select container
            document.getElementById('blocked-actions').style.display = 'none';
            document.getElementById('selection-actions').style.display = 'flex';
            document.getElementById('multi-select-container').style.display = 'none';
            const selectionHint = document.getElementById('selection-hint');
            if (selectionHint) selectionHint.style.display = 'inline';
            
            updateSelectionCount();
        }
        
        function exitSelectionMode() {
            isSelectionMode = false;
            selectedCalls.clear();
            
            // Hide checkboxes and show individual action buttons
            document.querySelectorAll('.blocked-call-item').forEach(item => {
                item.querySelector('.selection-checkbox').style.display = 'none';
                item.querySelector('.item-actions').style.display = 'flex';
                item.style.backgroundColor = 'transparent';
                item.style.cursor = 'default';
                
                const checkbox = item.querySelector('.selection-checkbox');
                const checkmark = checkbox.querySelector('.checkmark');
                checkbox.style.backgroundColor = 'transparent';
                checkmark.style.display = 'none';
            });
            
            // Switch header actions back and show multi-select container
            document.getElementById('blocked-actions').style.display = 'block';
            document.getElementById('selection-actions').style.display = 'none';
            document.getElementById('multi-select-container').style.display = 'block';
            const selectionHint = document.getElementById('selection-hint');
            if (selectionHint) selectionHint.style.display = 'none';
        }
        
        function toggleItemSelection(item) {
            const phoneNumber = item.dataset.phone;
            const checkbox = item.querySelector('.selection-checkbox');
            const checkmark = checkbox.querySelector('.checkmark');
            
            if (selectedCalls.has(phoneNumber)) {
                selectedCalls.delete(phoneNumber);
                checkbox.style.backgroundColor = 'transparent';
                checkmark.style.display = 'none';
            } else {
                selectedCalls.add(phoneNumber);
                checkbox.style.backgroundColor = '#007aff';
                checkmark.style.display = 'block';
            }
            
            updateSelectionCount();
        }
        
        function updateSelectionCount() {
            const count = selectedCalls.size;
            document.getElementById('selection-count').textContent = `${count} selected`;
            
            // Disable both buttons when no items selected
            const removeBtn = document.querySelector('#selection-actions button[onclick="removeSelected()"]');
            const whitelistBtn = document.querySelector('#selection-actions button[onclick="whitelistSelected()"]');
            
            if (removeBtn) removeBtn.disabled = count === 0;
            if (whitelistBtn) whitelistBtn.disabled = count === 0;
        }
        
        function cancelSelection() {
            exitSelectionMode();
        }
        
        function removeSelected() {
            const count = selectedCalls.size;
            if (count === 0) return;
            
            showCustomConfirm(
                `Remove ${count} Selected Call${count > 1 ? 's' : ''}?`,
                `This will remove ${count} blocked call${count > 1 ? 's' : ''} from your list.`,
                `Remove ${count}`,
                'Cancel',
                function() {
                    selectedCalls.forEach(phoneNumber => {
                        removeBlockedCallFromList(phoneNumber);
                    });
                    exitSelectionMode();
                    updateBlockedCallsCount();
                    showCustomAlert('Removed', `${count} blocked call${count > 1 ? 's have' : ' has'} been removed.`);
                }
            );
        }
        
        function whitelistSelected() {
            const count = selectedCalls.size;
            if (count === 0) return;
            
            showCustomConfirm(
                `Add ${count} Selected Call${count > 1 ? 's' : ''} to Trusted Contacts?`,
                `${count} contact${count > 1 ? 's' : ''} will bypass call screening in future calls.`,
                `Add ${count} to Trusted`,
                'Cancel',
                function() {
                    selectedCalls.forEach(phoneNumber => {
                        // Remove from blocked list
                        removeBlockedCallFromList(phoneNumber);
                        // Add to trusted contacts
                        addToTrustedContacts(phoneNumber);
                    });
                    exitSelectionMode();
                    updateBlockedCallsCount();
                    updateTrustedContactsCount();
                    showCustomAlert('Success!', `${count} contact${count > 1 ? 's have' : ' has'} been added to your trusted contacts.`);
                }
            );
        }
        
        function addToTrustedContacts(phoneNumber) {
            const contactsList = document.getElementById('contacts-list');
            if (!contactsList) return;
            
            // Check if contact already exists
            const existingContact = document.querySelector(`[data-phone="${phoneNumber}"]`);
            if (existingContact) return;
            
            // Generate a unique contact ID based on phone number
            const contactId = 'contact_' + phoneNumber.replace(/\D/g, '');
            
            // Create new contact element
            const contactElement = document.createElement('div');
            contactElement.className = 'list-item contact-item';
            contactElement.setAttribute('data-contact', contactId);
            contactElement.setAttribute('data-phone', phoneNumber);
            contactElement.onclick = function() { 
                if (!isContactsSelectionMode) {
                    showContactDetail(contactId); 
                }
            };
            
            // Get initials from phone number (use last 2 digits)
            const digits = phoneNumber.replace(/\D/g, '');
            const initials = digits.slice(-2);
            
            contactElement.innerHTML = `
                <div class="contacts-selection-checkbox" style="display: none; margin-right: 12px; width: 20px; height: 20px; border: 2px solid #007aff; border-radius: 4px; position: relative;">
                    <div class="checkmark" style="display: none; position: absolute; top: 2px; left: 6px; width: 6px; height: 10px; border: solid white; border-width: 0 2px 2px 0; transform: rotate(45deg);"></div>
                </div>
                <div class="list-avatar" style="background: #007aff; color: white; font-weight: 600;">${initials}</div>
                <div class="list-content">
                    <div class="list-title">${phoneNumber}</div>
                    <div class="list-subtitle">Added from blocked calls</div>
                </div>
                <div class="contact-actions" style="display: flex; gap: 4px;">
                    <button onclick="event.stopPropagation(); removeContact('${contactId}')" style="background: #ff3b30; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 11px;">Remove</button>
                </div>
            `;
            
            // Add to contacts list
            contactsList.appendChild(contactElement);
            
            // Re-initialize click selection for the new contact
            initializeContactsClickSelection();
        }

        
        // Contacts selection functionality
        let isContactsSelectionMode = false;
        let selectedContacts = new Set();
        
        function addContactsMultiSelectButton() {
            const contactsMultiSelectContainer = document.getElementById('contacts-multi-select-container');
            if (contactsMultiSelectContainer && !document.getElementById('contacts-multi-select-btn')) {
                const multiSelectBtn = document.createElement('button');
                multiSelectBtn.id = 'contacts-multi-select-btn';
                multiSelectBtn.textContent = 'Select Multiple';
                multiSelectBtn.style.cssText = 'background: #007aff; color: white; border: none; border-radius: 6px; padding: 8px 16px; font-size: 12px;';
                multiSelectBtn.onclick = function() {
                    enterContactsSelectionMode();
                };
                contactsMultiSelectContainer.appendChild(multiSelectBtn);
            }
        }
        
        function selectAllContacts() {
            if (!isContactsSelectionMode) {
                enterContactsSelectionMode();
            }
            
            const contactItems = document.querySelectorAll('.contact-item');
            contactItems.forEach(item => {
                const contactId = item.getAttribute('data-contact');
                if (contactId && !selectedContacts.has(contactId)) {
                    selectedContacts.add(contactId);
                    
                    const checkbox = item.querySelector('.contacts-selection-checkbox');
                    const checkmark = checkbox.querySelector('.checkmark');
                    checkbox.style.backgroundColor = '#007aff';
                    checkmark.style.display = 'block';
                    item.style.backgroundColor = '#e3f2fd';
                }
            });
            
            updateContactsSelectionCount();
        }
        
        function enterContactsSelectionMode() {
            isContactsSelectionMode = true;
            selectedContacts.clear();
            
            document.querySelectorAll('.contact-item').forEach(item => {
                item.querySelector('.contacts-selection-checkbox').style.display = 'block';
                item.querySelector('.contact-actions').style.display = 'none';
                item.style.backgroundColor = '#f8f9fa';
                item.style.cursor = 'pointer';
            });
            
            document.getElementById('contacts-actions').style.display = 'none';
            document.getElementById('contacts-selection-actions').style.display = 'flex';
            document.getElementById('contacts-multi-select-container').style.display = 'none';
            
            updateContactsSelectionCount();
        }
        
        function cancelContactsSelection() {
            isContactsSelectionMode = false;
            selectedContacts.clear();
            
            document.querySelectorAll('.contact-item').forEach(item => {
                item.querySelector('.contacts-selection-checkbox').style.display = 'none';
                item.querySelector('.contact-actions').style.display = 'flex';
                item.style.backgroundColor = 'transparent';
                item.style.cursor = 'default';
                
                const checkbox = item.querySelector('.contacts-selection-checkbox');
                const checkmark = checkbox.querySelector('.checkmark');
                checkbox.style.backgroundColor = 'transparent';
                checkmark.style.display = 'none';
            });
            
            document.getElementById('contacts-actions').style.display = 'block';
            document.getElementById('contacts-selection-actions').style.display = 'none';
            document.getElementById('contacts-multi-select-container').style.display = 'block';
        }
        
        function updateContactsSelectionCount() {
            const count = selectedContacts.size;
            const countElement = document.getElementById('contacts-selection-count');
            if (countElement) {
                countElement.textContent = `${count} selected`;
            }
        }
        
        function removeSelectedContacts() {
            const count = selectedContacts.size;
            if (count === 0) return;
            
            showCustomConfirm(
                `Remove ${count} Selected Contact${count > 1 ? 's' : ''}?`,
                `${count} contact${count > 1 ? 's' : ''} will be removed from your trusted list.`,
                `Remove ${count}`,
                'Cancel',
                function() {
                    selectedContacts.forEach(contactId => {
                        removeContactFromList(contactId);
                    });
                    cancelContactsSelection();
                    updateTrustedContactsCount();
                    showCustomAlert('Removed!', `${count} contact${count > 1 ? 's have' : ' has'} been removed from your trusted contacts.`);
                }
            );
        }
        
        function removeContactFromList(contactId) {
            const contactItem = document.querySelector(`[data-contact="${contactId}"]`);
            if (contactItem) {
                contactItem.remove();
            }
        }
        
        function getTrustedContactsCount() {
            const contactItems = document.querySelectorAll('.contact-item');
            return contactItems.length;
        }
        
        function updateTrustedContactsCount() {
            const contactItems = document.querySelectorAll('.contact-item');
            const count = contactItems.length;
            
            // Update header count
            const headerElement = document.querySelector('#contacts div[style*="font-weight: 600"]');
            if (headerElement) {
                headerElement.textContent = `Trusted Contacts (${count})`;
            }
            
            // Update home screen stat
            const trustedContactsStat = document.getElementById('trusted-contacts-stat');
            if (trustedContactsStat) {
                trustedContactsStat.textContent = count;
            }
            
            // Hide multi-select button if no contacts
            const multiSelectContainer = document.getElementById('contacts-multi-select-container');
            const actionsContainer = document.getElementById('contacts-actions');
            if (count === 0) {
                if (multiSelectContainer) multiSelectContainer.style.display = 'none';
                if (actionsContainer) actionsContainer.style.display = 'none';
                
                // Show empty state
                const contactsList = document.getElementById('contacts-list');
                if (contactsList && contactsList.children.length === 0) {
                    contactsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #8e8e93; font-size: 14px;">No trusted contacts</div>';
                }
            } else {
                if (multiSelectContainer) multiSelectContainer.style.display = 'block';
                if (actionsContainer) actionsContainer.style.display = 'flex';
            }
        }
        
        function removeContact(contactId) {
            showCustomConfirm(
                'Remove Contact?',
                'This contact will no longer bypass call screening.',
                'Remove',
                'Cancel',
                function() {
                    removeContactFromList(contactId);
                    updateTrustedContactsCount();
                    showCustomAlert('Removed', 'Contact has been removed from trusted contacts.');
                }
            );
        }
        
        function initializeContactsClickSelection() {
            document.querySelectorAll('.contact-item').forEach(item => {
                const newItem = item.cloneNode(true);
                item.parentNode.replaceChild(newItem, item);
                
                newItem.addEventListener('click', function(e) {
                    if (!isContactsSelectionMode) {
                        return; // Normal behavior
                    }
                    
                    if (e.target.tagName !== 'BUTTON' && e.target.closest('.contact-actions') === null) {
                        e.preventDefault();
                        e.stopPropagation();
                        toggleContactSelection(newItem);
                    }
                });
            });
        }
        
        function toggleContactSelection(item) {
            const contactId = item.dataset.contact;
            const checkbox = item.querySelector('.contacts-selection-checkbox');
            const checkmark = checkbox.querySelector('.checkmark');
            
            if (selectedContacts.has(contactId)) {
                selectedContacts.delete(contactId);
                checkbox.style.backgroundColor = 'transparent';
                checkmark.style.display = 'none';
                item.style.backgroundColor = '#f8f9fa';
            } else {
                selectedContacts.add(contactId);
                checkbox.style.backgroundColor = '#007aff';
                checkmark.style.display = 'block';
                item.style.backgroundColor = '#e3f2fd';
            }
            
            updateContactsSelectionCount();
        }
        
        // Initialize multi-select when page loads
        document.addEventListener('DOMContentLoaded', function() {
            addMultiSelectButton();
            addContactsMultiSelectButton();
            initializeClickSelection();
            initializeContactsClickSelection();
            updateTrustedContactsCount();
            
            // Enhance the showAnalytics function after DOM is loaded
            if (typeof showAnalytics === 'function') {
                const originalShowAnalytics = showAnalytics;
                showAnalytics = function() {
                    originalShowAnalytics();
                    setTimeout(() => {
                        addMultiSelectButton();
                        initializeClickSelection();
                    }, 100);
                };
            }
        });
    </script>
</body>
</html>