<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CallBunker Signup</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .title {
            font-size: 28px;
            font-weight: bold;
            color: #007AFF;
            margin-bottom: 8px;
        }
        
        .subtitle {
            font-size: 16px;
            color: #8e8e93;
            line-height: 1.4;
        }
        
        .form-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 16px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .label {
            font-size: 16px;
            font-weight: 600;
            color: #1c1c1e;
            margin-bottom: 8px;
            display: block;
        }
        
        .input {
            width: 100%;
            border: 1px solid #e5e5ea;
            border-radius: 8px;
            padding: 12px;
            font-size: 16px;
            background: #f8f9fa;
            color: #1c1c1e;
            box-sizing: border-box;
        }
        
        .input:focus {
            border-color: #007AFF;
            outline: none;
            background: white;
        }
        
        .help-text {
            font-size: 14px;
            color: #8e8e93;
            margin-top: 6px;
        }
        
        .help-link {
            color: #007AFF;
            text-decoration: none;
        }
        
        .input-group {
            display: flex;
            gap: 8px;
        }
        
        .get-number-btn {
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 14px;
            text-decoration: none;
            display: flex;
            align-items: center;
            white-space: nowrap;
        }
        
        .get-number-btn:hover {
            background: #0056CC;
            color: white;
            text-decoration: none;
        }
        
        .row {
            display: flex;
            gap: 12px;
        }
        
        .col {
            flex: 1;
        }
        
        .signup-button {
            background: #007AFF;
            border: none;
            border-radius: 8px;
            padding: 16px;
            width: 100%;
            color: white;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
        }
        
        .signup-button:hover {
            background: #0056CC;
        }
        
        .signup-button:disabled {
            background: #8e8e93;
            cursor: not-allowed;
        }
        
        .info-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .info-title {
            font-size: 18px;
            font-weight: 600;
            color: #1c1c1e;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
        }
        
        .steps {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }
        
        .step {
            text-align: center;
        }
        
        .step-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }
        
        .step-title {
            font-size: 14px;
            font-weight: 600;
            color: #1c1c1e;
            margin-bottom: 4px;
        }
        
        .step-subtitle {
            font-size: 12px;
            color: #8e8e93;
            line-height: 1.3;
        }
        
        .step-link {
            display: inline-block;
            margin-top: 8px;
            padding: 4px 8px;
            background: #007AFF;
            color: white;
            border-radius: 6px;
            font-size: 11px;
            text-decoration: none;
        }
        
        .success-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .success-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 350px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            margin: 20px;
        }
        
        .success-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        .success-title {
            font-size: 20px;
            font-weight: 600;
            color: #1c1c1e;
            margin-bottom: 12px;
        }
        
        .defense-number {
            background: #e8f5e8;
            color: #4caf50;
            padding: 12px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            margin: 16px 0;
            font-family: monospace;
            letter-spacing: 1px;
        }
        
        .continue-btn {
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">ğŸ›¡ï¸ {{ _("Join CallBunker") }}</div>
            <div class="subtitle">{{ _("Direct Voice SDK calling with advanced call screening") }}</div>
        </div>
        
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div style="margin-bottom: 20px;">
                    {% for category, message in messages %}
                        <div style="padding: 12px; border-radius: 8px; margin-bottom: 10px; {% if category == 'error' %}background: #fee; color: #c33; border: 1px solid #fcc;{% else %}background: #efe; color: #363; border: 1px solid #cfc;{% endif %}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <div class="form-card">
            <form method="POST" id="signupForm">
                <div class="form-group">
                    <label for="name" class="label">{{ _("Full Name") }}</label>
                    <input type="text" class="input" id="name" name="name" value="{{ request.form.get('name', '') }}" required>
                    <div class="help-text">{{ _("Your name for account identification") }}</div>
                </div>
                
                <div class="form-group">
                    <label for="email" class="label">{{ _("Email Address") }}</label>
                    <input type="email" class="input" id="email" name="email" value="{{ request.form.get('email', '') }}" required>
                    <div class="help-text">{{ _("For account management and notifications") }}</div>
                </div>
                
                <div class="form-group">
                    <label for="country" class="label">ğŸŒ {{ _("Country") }}</label>
                    <select class="input" id="country" name="country" required onchange="updateLanguage()">
                        <option value="">{{ _("Select your country...") }}</option>
                        <option value="US" data-lang="en" data-flag="ğŸ‡ºğŸ‡¸">ğŸ‡ºğŸ‡¸ United States</option>
                        <option value="CA" data-lang="en" data-flag="ğŸ‡¨ğŸ‡¦">ğŸ‡¨ğŸ‡¦ Canada</option>
                        <option value="GB" data-lang="en" data-flag="ğŸ‡¬ğŸ‡§">ğŸ‡¬ğŸ‡§ United Kingdom</option>
                        <option value="AU" data-lang="en" data-flag="ğŸ‡¦ğŸ‡º">ğŸ‡¦ğŸ‡º Australia</option>
                        <option value="ES" data-lang="es" data-flag="ğŸ‡ªğŸ‡¸">ğŸ‡ªğŸ‡¸ Spain</option>
                        <option value="MX" data-lang="es" data-flag="ğŸ‡²ğŸ‡½">ğŸ‡²ğŸ‡½ Mexico</option>
                        <option value="AR" data-lang="es" data-flag="ğŸ‡¦ğŸ‡·">ğŸ‡¦ğŸ‡· Argentina</option>
                        <option value="CO" data-lang="es" data-flag="ğŸ‡¨ğŸ‡´">ğŸ‡¨ğŸ‡´ Colombia</option>
                        <option value="FR" data-lang="fr" data-flag="ğŸ‡«ğŸ‡·">ğŸ‡«ğŸ‡· France</option>
                        <option value="BE" data-lang="fr" data-flag="ğŸ‡§ğŸ‡ª">ğŸ‡§ğŸ‡ª Belgium</option>
                        <option value="CH" data-lang="fr" data-flag="ğŸ‡¨ğŸ‡­">ğŸ‡¨ğŸ‡­ Switzerland</option>
                        <option value="DE" data-lang="de" data-flag="ğŸ‡©ğŸ‡ª">ğŸ‡©ğŸ‡ª Germany</option>
                        <option value="AT" data-lang="de" data-flag="ğŸ‡¦ğŸ‡¹">ğŸ‡¦ğŸ‡¹ Austria</option>
                        <option value="IT" data-lang="it" data-flag="ğŸ‡®ğŸ‡¹">ğŸ‡®ğŸ‡¹ Italy</option>
                        <option value="PT" data-lang="pt" data-flag="ğŸ‡µğŸ‡¹">ğŸ‡µğŸ‡¹ Portugal</option>
                        <option value="BR" data-lang="pt" data-flag="ğŸ‡§ğŸ‡·">ğŸ‡§ğŸ‡· Brazil</option>
                        <option value="NL" data-lang="nl" data-flag="ğŸ‡³ğŸ‡±">ğŸ‡³ğŸ‡± Netherlands</option>
                        <option value="SE" data-lang="sv" data-flag="ğŸ‡¸ğŸ‡ª">ğŸ‡¸ğŸ‡ª Sweden</option>
                        <option value="NO" data-lang="no" data-flag="ğŸ‡³ğŸ‡´">ğŸ‡³ğŸ‡´ Norway</option>
                        <option value="DK" data-lang="da" data-flag="ğŸ‡©ğŸ‡°">ğŸ‡©ğŸ‡° Denmark</option>
                        <option value="FI" data-lang="fi" data-flag="ğŸ‡«ğŸ‡®">ğŸ‡«ğŸ‡® Finland</option>
                        <option value="PL" data-lang="pl" data-flag="ğŸ‡µğŸ‡±">ğŸ‡µğŸ‡± Poland</option>
                        <option value="CZ" data-lang="cs" data-flag="ğŸ‡¨ğŸ‡¿">ğŸ‡¨ğŸ‡¿ Czech Republic</option>
                        <option value="HU" data-lang="hu" data-flag="ğŸ‡­ğŸ‡º">ğŸ‡­ğŸ‡º Hungary</option>
                        <option value="RO" data-lang="ro" data-flag="ğŸ‡·ğŸ‡´">ğŸ‡·ğŸ‡´ Romania</option>
                        <option value="GR" data-lang="el" data-flag="ğŸ‡¬ğŸ‡·">ğŸ‡¬ğŸ‡· Greece</option>
                        <option value="JP" data-lang="ja" data-flag="ğŸ‡¯ğŸ‡µ">ğŸ‡¯ğŸ‡µ Japan</option>
                        <option value="KR" data-lang="ko" data-flag="ğŸ‡°ğŸ‡·">ğŸ‡°ğŸ‡· South Korea</option>
                        <option value="CN" data-lang="zh" data-flag="ğŸ‡¨ğŸ‡³">ğŸ‡¨ğŸ‡³ China</option>
                        <option value="IN" data-lang="hi" data-flag="ğŸ‡®ğŸ‡³">ğŸ‡®ğŸ‡³ India</option>
                        <option value="SG" data-lang="en" data-flag="ğŸ‡¸ğŸ‡¬">ğŸ‡¸ğŸ‡¬ Singapore</option>
                        <option value="PH" data-lang="en" data-flag="ğŸ‡µğŸ‡­">ğŸ‡µğŸ‡­ Philippines</option>
                        <option value="TH" data-lang="th" data-flag="ğŸ‡¹ğŸ‡­">ğŸ‡¹ğŸ‡­ Thailand</option>
                        <option value="VN" data-lang="vi" data-flag="ğŸ‡»ğŸ‡³">ğŸ‡»ğŸ‡³ Vietnam</option>
                        <option value="ID" data-lang="id" data-flag="ğŸ‡®ğŸ‡©">ğŸ‡®ğŸ‡© Indonesia</option>
                        <option value="MY" data-lang="ms" data-flag="ğŸ‡²ğŸ‡¾">ğŸ‡²ğŸ‡¾ Malaysia</option>
                        <option value="ZA" data-lang="en" data-flag="ğŸ‡¿ğŸ‡¦">ğŸ‡¿ğŸ‡¦ South Africa</option>
                        <option value="NG" data-lang="en" data-flag="ğŸ‡³ğŸ‡¬">ğŸ‡³ğŸ‡¬ Nigeria</option>
                        <option value="KE" data-lang="en" data-flag="ğŸ‡°ğŸ‡ª">ğŸ‡°ğŸ‡ª Kenya</option>
                        <option value="EG" data-lang="ar" data-flag="ğŸ‡ªğŸ‡¬">ğŸ‡ªğŸ‡¬ Egypt</option>
                        <option value="SA" data-lang="ar" data-flag="ğŸ‡¸ğŸ‡¦">ğŸ‡¸ğŸ‡¦ Saudi Arabia</option>
                        <option value="AE" data-lang="ar" data-flag="ğŸ‡¦ğŸ‡ª">ğŸ‡¦ğŸ‡ª UAE</option>
                        <option value="IL" data-lang="he" data-flag="ğŸ‡®ğŸ‡±">ğŸ‡®ğŸ‡± Israel</option>
                        <option value="TR" data-lang="tr" data-flag="ğŸ‡¹ğŸ‡·">ğŸ‡¹ğŸ‡· Turkey</option>
                        <option value="RU" data-lang="ru" data-flag="ğŸ‡·ğŸ‡º">ğŸ‡·ğŸ‡º Russia</option>
                        <option value="UA" data-lang="uk" data-flag="ğŸ‡ºğŸ‡¦">ğŸ‡ºğŸ‡¦ Ukraine</option>
                        <option value="BY" data-lang="be" data-flag="ğŸ‡§ğŸ‡¾">ğŸ‡§ğŸ‡¾ Belarus</option>
                        <option value="KZ" data-lang="kk" data-flag="ğŸ‡°ğŸ‡¿">ğŸ‡°ğŸ‡¿ Kazakhstan</option>
                        <option value="NZ" data-lang="en" data-flag="ğŸ‡³ğŸ‡¿">ğŸ‡³ğŸ‡¿ New Zealand</option>
                        <option value="ZZ" data-lang="en" data-flag="ğŸŒ">ğŸŒ Other Country</option>
                    </select>
                    <div class="help-text">{{ _("This will set your app language and optimize call routing") }}</div>
                </div>
                
                <div class="form-group">
                    <label for="real_phone_number" class="label">{{ _("Your Phone Number") }}</label>
                    <input type="tel" class="input" id="real_phone_number" name="real_phone_number" 
                           placeholder="(555) 987-6543" value="{{ request.form.get('real_phone_number', '') }}" required>
                    <div class="help-text">{{ _("Your actual phone number for forwarding screened calls") }}</div>
                </div>
                
                <div class="form-group">
                    <label for="password" class="label">{{ _("Create Password") }}</label>
                    <div style="position: relative;">
                        <input type="password" class="input" id="password" name="password" 
                               placeholder="{{ _("Enter a secure password") }}" required minlength="6">
                        <button type="button" onclick="togglePassword('password')" 
                                style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #8e8e93; cursor: pointer; font-size: 16px;">
                            ğŸ‘ï¸
                        </button>
                    </div>
                    <div class="help-text">{{ _("For logging into your CallBunker account") }}</div>
                </div>
                
                <div class="form-group">
                    <label for="confirm_password" class="label">{{ _("Re-enter Password") }}</label>
                    <div style="position: relative;">
                        <input type="password" class="input" id="confirm_password" name="confirm_password" 
                               placeholder="{{ _("Confirm your password") }}" required minlength="6">
                        <button type="button" onclick="togglePassword('confirm_password')" 
                                style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #8e8e93; cursor: pointer; font-size: 16px;">
                            ğŸ‘ï¸
                        </button>
                    </div>
                    <div class="help-text">{{ _("Must match the password above") }}</div>
                </div>
                
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="pin" class="label">{{ _("4-Digit PIN") }}</label>
                            <input type="text" class="input" id="pin" name="pin" 
                                   value="1122" maxlength="4" pattern="[0-9]{4}" required>
                            <div class="help-text">{{ _("Callers enter this on keypad") }}</div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="verbal_code" class="label">{{ _("Verbal Code") }}</label>
                            <input type="text" class="input" id="verbal_code" name="verbal_code" 
                                   value="open sesame" required>
                            <div class="help-text">{{ _("Callers can say this instead") }}</div>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="signup-button" {% if available_numbers == 0 %}disabled{% endif %}>
                    {% if available_numbers > 0 %}
                    ğŸš€ {{ _("Create My CallBunker Account") }}
                    {% else %}
                    {{ _("Join Waiting List") }}
                    {% endif %}
                </button>
            </form>
            
            <div class="login-link" style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e5e5e7;">
                <p style="color: #666; font-size: 14px; margin: 0;">{{ _("Already have an account?") }} <a href="/multi/login" style="color: #007AFF; text-decoration: none; font-weight: 600;">{{ _("Sign In") }}</a></p>
            </div>
        </div>
        
        <div class="info-card">
            <div class="info-title">
                â„¹ï¸ How Modern CallBunker Works
            </div>
            <div class="steps">
                <div class="step">
                    <div class="step-icon">ğŸ“±</div>
                    <div class="step-title">1. Sign Up</div>
                    <div class="step-subtitle">Get your Defense Number instantly</div>
                </div>
                <div class="step">
                    <div class="step-icon">ğŸ›¡ï¸</div>
                    <div class="step-title">2. Share Defense Number</div>
                    <div class="step-subtitle">Give out your CallBunker number</div>
                </div>
                <div class="step">
                    <div class="step-icon">ğŸ”</div>
                    <div class="step-title">3. Automatic Screening</div>
                    <div class="step-subtitle">PIN/verbal authentication</div>
                </div>
                <div class="step">
                    <div class="step-icon">â˜ï¸</div>
                    <div class="step-title">4. Direct Calling</div>
                    <div class="step-subtitle">Make calls via Voice SDK</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Success Modal -->
    <div class="success-modal" id="successModal">
        <div class="success-content">
            <div class="success-icon">ğŸ‰</div>
            <div class="success-title">Account Created!</div>
            <div>Your Defense Number is:</div>
            <div class="defense-number" id="defenseNumber"></div>
            <div style="font-size: 14px; color: #8e8e93; margin-bottom: 16px;">
                Your CallBunker system is ready to use!
            </div>
            <button class="continue-btn" onclick="continueToDashboard()">Access Dashboard</button>
        </div>
    </div>
    
    <script>
        // Form validation - let the form submit normally to Flask
        // Phone number formatting only
        
        // Phone number formatting
        function formatPhoneNumber(input) {
            const value = input.value.replace(/\D/g, '');
            if (value.length >= 10) {
                const formatted = `(${value.slice(0, 3)}) ${value.slice(3, 6)}-${value.slice(6, 10)}`;
                input.value = formatted;
            }
        }
        
        document.getElementById('real_phone_number').addEventListener('input', function() {
            formatPhoneNumber(this);
        });
        
        // Password toggle functionality
        function togglePassword(fieldId) {
            const field = document.getElementById(fieldId);
            const button = field.nextElementSibling;
            
            if (field.type === 'password') {
                field.type = 'text';
                button.textContent = 'ğŸ™ˆ';
            } else {
                field.type = 'password';
                button.textContent = 'ğŸ‘ï¸';
            }
        }
        
        // Simple form validation - check passwords match
        function validateForm() {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm_password').value;
            const submitButton = document.querySelector('.signup-button');
            
            // Only validate if confirm password has content
            if (confirmPassword && password !== confirmPassword) {
                document.getElementById('confirm_password').style.borderColor = '#ff3b30';
                document.getElementById('confirm_password').style.backgroundColor = '#fff2f2';
                submitButton.disabled = true;
                submitButton.style.backgroundColor = '#8e8e93';
            } else {
                document.getElementById('confirm_password').style.borderColor = '#e5e5ea';
                document.getElementById('confirm_password').style.backgroundColor = '#f8f9fa';
                // Re-enable button if available_numbers allows it
                {% if available_numbers > 0 %}
                submitButton.disabled = false;
                submitButton.style.backgroundColor = '#007AFF';
                {% endif %}
            }
        }
        
        // Password confirmation validation
        document.getElementById('confirm_password').addEventListener('input', validateForm);
        document.getElementById('password').addEventListener('input', validateForm);
        
        // Language and localization mapping
        const translations = {
            en: {
                title: "ğŸ›¡ï¸ Join CallBunker",
                subtitle: "Direct Voice SDK calling with advanced call screening",
                fullName: "Full Name",
                nameHelp: "Your name for account identification",
                emailAddress: "Email Address", 
                emailHelp: "For account management and notifications",
                country: "ğŸŒ Country",
                countryHelp: "This will set your app language and optimize call routing",
                yourPhone: "Your Phone Number",
                phoneHelp: "Your actual phone number for forwarding screened calls",
                createPassword: "Create Password",
                passwordHelp: "For logging into your CallBunker account",
                reenterPassword: "Re-enter Password",
                confirmHelp: "Must match the password above",
                fourDigitPIN: "4-Digit PIN",
                pinHelp: "Callers enter this on keypad",
                verbalCode: "Verbal Code",
                verbalHelp: "Callers can say this instead",
                createAccount: "â³ Creating Account...",
                createButton: "ğŸš€ Create Account",
                alreadyHave: "Already have an account?",
                signIn: "Sign In"
            },
            es: {
                title: "ğŸ›¡ï¸ Ãšnete a CallBunker",
                subtitle: "Llamadas directas con SDK de voz y filtrado avanzado",
                fullName: "Nombre Completo",
                nameHelp: "Tu nombre para identificaciÃ³n de cuenta",
                emailAddress: "DirecciÃ³n de Email",
                emailHelp: "Para gestiÃ³n de cuenta y notificaciones",
                country: "ğŸŒ PaÃ­s",
                countryHelp: "Esto establecerÃ¡ el idioma de tu app y optimizarÃ¡ el enrutamiento",
                yourPhone: "Tu NÃºmero de TelÃ©fono",
                phoneHelp: "Tu nÃºmero real para reenviar llamadas filtradas",
                createPassword: "Crear ContraseÃ±a",
                passwordHelp: "Para iniciar sesiÃ³n en tu cuenta CallBunker",
                reenterPassword: "Vuelve a ingresar ContraseÃ±a",
                confirmHelp: "Debe coincidir con la contraseÃ±a anterior",
                fourDigitPIN: "PIN de 4 DÃ­gitos",
                pinHelp: "Los llamadores ingresan esto en el teclado",
                verbalCode: "CÃ³digo Verbal",
                verbalHelp: "Los llamadores pueden decir esto en su lugar",
                createAccount: "â³ Creando Cuenta...",
                createButton: "ğŸš€ Crear Cuenta",
                alreadyHave: "Â¿Ya tienes una cuenta?",
                signIn: "Iniciar SesiÃ³n"
            },
            fr: {
                title: "ğŸ›¡ï¸ Rejoindre CallBunker",
                subtitle: "Appels directs avec SDK vocal et filtrage avancÃ©",
                fullName: "Nom Complet",
                nameHelp: "Votre nom pour l'identification du compte",
                emailAddress: "Adresse Email",
                emailHelp: "Pour la gestion de compte et les notifications",
                country: "ğŸŒ Pays",
                countryHelp: "Ceci dÃ©finira la langue de votre app et optimisera le routage",
                yourPhone: "Votre NumÃ©ro de TÃ©lÃ©phone",
                phoneHelp: "Votre numÃ©ro rÃ©el pour transfÃ©rer les appels filtrÃ©s",
                createPassword: "CrÃ©er un Mot de Passe",
                passwordHelp: "Pour vous connecter Ã  votre compte CallBunker",
                reenterPassword: "Ressaisir le Mot de Passe",
                confirmHelp: "Doit correspondre au mot de passe ci-dessus",
                fourDigitPIN: "PIN Ã  4 Chiffres",
                pinHelp: "Les appelants saisissent ceci sur le clavier",
                verbalCode: "Code Verbal",
                verbalHelp: "Les appelants peuvent dire ceci Ã  la place",
                createAccount: "â³ CrÃ©ation du Compte...",
                createButton: "ğŸš€ CrÃ©er un Compte",
                alreadyHave: "Vous avez dÃ©jÃ  un compte?",
                signIn: "Se Connecter"
            },
            de: {
                title: "ğŸ›¡ï¸ CallBunker Beitreten",
                subtitle: "Direkte Voice SDK Anrufe mit erweitertem Anruffilter",
                fullName: "VollstÃ¤ndiger Name",
                nameHelp: "Ihr Name zur Kontoidentifikation",
                emailAddress: "E-Mail Adresse",
                emailHelp: "FÃ¼r Kontoverwaltung und Benachrichtigungen",
                country: "ğŸŒ Land",
                countryHelp: "Dies setzt Ihre App-Sprache und optimiert das Routing",
                yourPhone: "Ihre Telefonnummer",
                phoneHelp: "Ihre echte Nummer fÃ¼r die Weiterleitung gefilterter Anrufe",
                createPassword: "Passwort Erstellen",
                passwordHelp: "Zum Anmelden bei Ihrem CallBunker-Konto",
                reenterPassword: "Passwort Wiederholen",
                confirmHelp: "Muss mit dem obigen Passwort Ã¼bereinstimmen",
                fourDigitPIN: "4-stellige PIN",
                pinHelp: "Anrufer geben dies auf der Tastatur ein",
                verbalCode: "Verbaler Code",
                verbalHelp: "Anrufer kÃ¶nnen dies stattdessen sagen",
                createAccount: "â³ Konto Wird Erstellt...",
                createButton: "ğŸš€ Konto Erstellen",
                alreadyHave: "Haben Sie bereits ein Konto?",
                signIn: "Anmelden"
            }
        };
        
        // Update page language based on country selection
        function updateLanguage() {
            const countrySelect = document.getElementById('country');
            const selectedOption = countrySelect.options[countrySelect.selectedIndex];
            const language = selectedOption.getAttribute('data-lang') || 'en';
            
            // Map languages to supported translations
            const supportedLang = translations[language] ? language : 'en';
            const t = translations[supportedLang];
            
            // Update all translatable elements
            document.querySelector('.title').textContent = t.title;
            document.querySelector('.subtitle').textContent = t.subtitle;
            
            // Update labels
            document.querySelector('label[for="name"]').textContent = t.fullName;
            document.querySelector('label[for="email"]').textContent = t.emailAddress;
            document.querySelector('label[for="country"]').textContent = t.country;
            document.querySelector('label[for="real_phone_number"]').textContent = t.yourPhone;
            document.querySelector('label[for="password"]').textContent = t.createPassword;
            document.querySelector('label[for="confirm_password"]').textContent = t.reenterPassword;
            document.querySelector('label[for="pin"]').textContent = t.fourDigitPIN;
            document.querySelector('label[for="verbal_code"]').textContent = t.verbalCode;
            
            // Update help texts
            const helpTexts = document.querySelectorAll('.help-text');
            if (helpTexts[0]) helpTexts[0].textContent = t.nameHelp;
            if (helpTexts[1]) helpTexts[1].textContent = t.emailHelp;
            if (helpTexts[2]) helpTexts[2].textContent = t.countryHelp;
            if (helpTexts[3]) helpTexts[3].textContent = t.phoneHelp;
            if (helpTexts[4]) helpTexts[4].textContent = t.passwordHelp;
            if (helpTexts[5]) helpTexts[5].textContent = t.confirmHelp;
            if (helpTexts[6]) helpTexts[6].textContent = t.pinHelp;
            if (helpTexts[7]) helpTexts[7].textContent = t.verbalHelp;
            
            // Update button text
            const createButton = document.querySelector('.signup-button');
            if (createButton && !createButton.disabled) {
                createButton.textContent = t.createButton;
            }
            
            // Store selected language for form submission
            const languageInput = document.getElementById('selected_language') || document.createElement('input');
            languageInput.type = 'hidden';
            languageInput.id = 'selected_language';
            languageInput.name = 'selected_language';
            languageInput.value = supportedLang;
            if (!document.getElementById('selected_language')) {
                document.getElementById('signupForm').appendChild(languageInput);
            }
            
            console.log(`Language updated to: ${supportedLang} (from country: ${countrySelect.value})`);
        }
        
        // Form submission with AJAX to trigger modal
        document.getElementById('signupForm').addEventListener('submit', function(e) {
            e.preventDefault(); // Always prevent default to use AJAX
            
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm_password').value;
            
            if (password !== confirmPassword) {
                alert('Passwords do not match. Please check and try again.');
                return false;
            }
            
            // Submit via AJAX to get JSON response for modal
            const formData = new FormData(this);
            const submitButton = document.querySelector('.signup-button');
            const originalText = submitButton.textContent;
            
            // Show loading state
            submitButton.disabled = true;
            submitButton.textContent = 'â³ Creating Account...';
            
            fetch('/multi/quick-signup', {
                method: 'POST',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'Accept': 'application/json'
                },
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    // Show success modal with Defense Number
                    document.getElementById('defenseNumber').textContent = data.defense_number;
                    document.getElementById('successModal').style.display = 'flex';
                } else {
                    alert('Signup failed: ' + (data.message || 'Please try again.'));
                }
            })
            .catch(error => {
                console.error('Signup error:', error);
                alert('Signup failed. Please try again.');
            })
            .finally(() => {
                // Reset button
                submitButton.disabled = false;
                submitButton.textContent = originalText;
            });
        });
        
        // Updated function name for new flow
        function continueToDashboard() {
            window.location.href = '/multi/dashboard';
        }
    </script>
</body>
</html>