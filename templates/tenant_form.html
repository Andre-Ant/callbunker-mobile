{% extends "base.html" %}

{% block title %}{{ action }} Tenant - CallBunker{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 col-lg-6 mx-auto">
        <div class="card bg-secondary">
            <div class="card-header">
                <h3 class="mb-0">
                    <i class="fas fa-{{ 'plus' if action == 'New' else 'edit' }} me-2"></i>{{ action }} Tenant
                </h3>
            </div>
            <div class="card-body">
                <form method="post">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="screening_number" class="form-label">Screening Number *</label>
                            <input type="text" class="form-control" name="screening_number" 
                                   value="{{ tenant.screening_number if tenant else '' }}" 
                                   placeholder="+15551234567"
                                   {{ 'readonly' if action == 'Edit' else 'required' }}>
                            <div class="form-text">Twilio phone number in E.164 format</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="owner_label" class="form-label">Owner Label</label>
                            <input type="text" class="form-control" name="owner_label" 
                                   value="{{ tenant.owner_label if tenant else '' }}" 
                                   placeholder="John's Business Line">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="forward_to" class="form-label">Forward To *</label>
                            <input type="text" class="form-control" name="forward_to" 
                                   value="{{ tenant.forward_to if tenant else '' }}" 
                                   placeholder="+15559876543" required>
                            <div class="form-text">Destination number in E.164 format</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="forward_mode" class="form-label">Forward Mode</label>
                            <select class="form-select" name="forward_mode">
                                <option value="bridge" {{ 'selected' if tenant and tenant.forward_mode == 'bridge' else '' }}>
                                    Bridge (Connect Call)
                                </option>
                                <option value="voicemail" {{ 'selected' if tenant and tenant.forward_mode == 'voicemail' else '' }}>
                                    Voicemail Only
                                </option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="current_pin" class="form-label">Default PIN *</label>
                            <input type="text" class="form-control" name="current_pin" 
                                   value="{{ tenant.current_pin if tenant else '1122' }}" 
                                   pattern="[0-9]{4}" maxlength="4" required>
                            <div class="form-text">4-digit numeric PIN</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="verbal_code" class="form-label">Verbal Code</label>
                            <input type="text" class="form-control" name="verbal_code" 
                                   value="{{ tenant.verbal_code if tenant else 'open sesame' }}" 
                                   placeholder="open sesame">
                            <div class="form-text">Spoken passphrase (case insensitive)</div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="retry_limit" class="form-label">Retry Limit</label>
                            <input type="number" class="form-control" name="retry_limit" 
                                   value="{{ tenant.retry_limit if tenant else 3 }}" 
                                   min="1" max="10">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="rl_max_attempts" class="form-label">Max Attempts</label>
                            <input type="number" class="form-control" name="rl_max_attempts" 
                                   value="{{ tenant.rl_max_attempts if tenant else 5 }}" 
                                   min="1" max="20">
                            <div class="form-text">Before blocking</div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="rl_block_minutes" class="form-label">Block Duration</label>
                            <input type="number" class="form-control" name="rl_block_minutes" 
                                   value="{{ tenant.rl_block_minutes if tenant else 60 }}" 
                                   min="5" max="1440">
                            <div class="form-text">Minutes</div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="rl_window_sec" class="form-label">Rate Limit Window</label>
                        <select class="form-select" name="rl_window_sec">
                            <option value="1800" {{ 'selected' if tenant and tenant.rl_window_sec == 1800 else '' }}>
                                30 minutes
                            </option>
                            <option value="3600" {{ 'selected' if tenant and tenant.rl_window_sec == 3600 else '' }}>
                                1 hour
                            </option>
                            <option value="7200" {{ 'selected' if tenant and tenant.rl_window_sec == 7200 else '' }}>
                                2 hours
                            </option>
                            <option value="86400" {{ 'selected' if tenant and tenant.rl_window_sec == 86400 else '' }}>
                                24 hours
                            </option>
                        </select>
                        <div class="form-text">Time window for counting failed attempts</div>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('admin.admin_home') }}" class="btn btn-secondary me-md-2">
                            <i class="fas fa-times me-2"></i>Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>{{ action }} Tenant
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
